<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPS | خدمات برقی هوشمند</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Vazirmatn:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-gold: #FFD700;
            --gold-light: #FFEE99;
            --gold-gradient: linear-gradient(135deg, #FFD700 0%, #FFAA00 100%);
            --diamond-blue: #00FFFF;
            --diamond-gradient: linear-gradient(135deg, #00FFFF 0%, #9966FF 100%);
            --dark-bg: #0A0F2B;
            --dark-card: #1A1F3C;
            --light-text: #F0F8FF;
            --radius-xl: 25px;
            --radius-lg: 18px;
            --radius-md: 12px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --shadow-gold: 0 10px 30px rgba(255, 215, 0, 0.2);
            --success-green: #51cf66;
            --error-red: #ff6b6b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            width: 100%;
            overflow-x: hidden;
        }
        
        body {
            background: var(--dark-bg);
            color: var(--light-text);
            font-family: 'Inter', 'Vazirmatn', sans-serif;
            line-height: 1.6;
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
        }
        
        /* هدر ثابت */
        .elegant-header {
            background: rgba(26, 31, 60, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 215, 0, 0.15);
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            z-index: 1000;
            padding: 12px 0;
            height: 60px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 42px !important;
            font-weight: 900;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
        }
        
        .user-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-name {
            font-size: 14px;
            color: var(--gold-light);
            font-family: 'Playfair Display', serif;
            display: none;
        }
        
        .user-icon {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gold-light);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .user-icon:hover {
            background: rgba(255, 215, 0, 0.15);
        }
        
        .user-icon.logged-in {
            background: rgba(255, 215, 0, 0.2);
            color: var(--primary-gold);
        }
        
        @keyframes slideText {
            0% { 
                transform: translateX(-50%) translateY(0);
                opacity: 0.9;
            }
            100% { 
                transform: translateX(-50%) translateY(-3px);
                opacity: 1;
            }
        }
        
        /* کانتینر اصلی */
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-top: 60px;
            margin-bottom: 70px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
            width: 100%;
        }
        
        /* صفحه اصلی */
        .home-page {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            min-height: calc(100vh - 130px);
            box-sizing: border-box;
            position: relative;
        }
        
        /* لامپ مرکزی */
        .lamp-container {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 0 auto 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .main-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, 
                rgba(255, 215, 0, 0.15) 0%,
                rgba(255, 215, 0, 0.05) 50%,
                transparent 70%);
            border: 2px solid rgba(255, 215, 0, 0.2);
            animation: circlePulse 4s infinite alternate;
        }
        
        .lamp-icon {
            font-size: 120px;
            color: var(--primary-gold);
            position: relative;
            z-index: 3;
            text-shadow: 
                0 0 20px rgba(255, 215, 0, 0.6),
                0 0 40px rgba(255, 215, 0, 0.4);
            animation: lampGlow 3s infinite alternate ease-in-out;
        }
        
        .lamp-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, 
                rgba(255, 248, 220, 0.3) 0%,
                rgba(255, 215, 0, 0.2) 30%,
                transparent 70%);
            animation: glowPulse 3s infinite alternate;
            z-index: 1;
        }
        
        .rotating-orbit {
            position: absolute;
            border-radius: 50%;
            border: 2px solid transparent;
            animation-duration: 15s;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }
        
        .orbit-1 {
            width: 240px;
            height: 240px;
            border-top: 2px solid rgba(255, 215, 0, 0.6);
            border-right: 2px solid rgba(255, 215, 0, 0.6);
            animation-name: rotateClockwise;
        }
        
        .orbit-2 {
            width: 260px;
            height: 260px;
            border-bottom: 2px solid rgba(0, 255, 255, 0.6);
            border-left: 2px solid rgba(0, 255, 255, 0.6);
            animation-name: rotateCounterClockwise;
        }
        
        .energy-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            filter: blur(1px);
            animation: particleFloat 3s infinite linear;
            z-index: 2;
        }
        
        /* متن صفحه اصلی */
        .welcome-text {
            margin-bottom: 30px;
            max-width: 600px;
        }
        
        .welcome-text h1 {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 15px;
            background: linear-gradient(90deg, 
                #FFD700 0%, 
                #00FFFF 50%, 
                #FF66B2 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-family: 'Playfair Display', serif;
        }
        
        .welcome-text p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            line-height: 1.8;
            font-family: 'Inter', sans-serif;
        }
        
        /* دکمه */
        .auth-button {
            margin-top: 10px;
        }
        
        .btn {
            padding: 16px 35px;
            border-radius: var(--radius-xl);
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: var(--gold-gradient);
            color: #1A1F3C;
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.25);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 215, 0, 0.35);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* تب‌های محتوا */
        .tab-content {
            display: none;
            padding: 30px 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* کارت پلن */
        .plan-card {
            background: var(--dark-card);
            border-radius: var(--radius-xl);
            padding: 25px;
            transition: all 0.3s ease;
            max-width: 500px;
            margin: 0 auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .plan-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.03));
            pointer-events: none;
        }
        
        .plan-card:hover {
            transform: translateY(-5px);
        }
        
        .plan-card.gold:hover {
            box-shadow: var(--shadow-gold);
        }
        
        .plan-card.diamond:hover {
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
        }
        
        .discount-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 14px;
            z-index: 2;
            pointer-events: none;
            user-select: none;
            font-family: 'Inter', sans-serif;
        }
        
        .gold .discount-badge {
            background: var(--gold-gradient);
            color: #1A1F3C;
        }
        
        .diamond .discount-badge {
            background: var(--diamond-gradient);
            color: #1A1F3C;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .plan-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .gold .plan-icon {
            background: var(--gold-gradient);
            color: #1A1F3C;
        }
        
        .diamond .plan-icon {
            background: var(--diamond-gradient);
            color: #1A1F3C;
        }
        
        .plan-title h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
            font-family: 'Inter', sans-serif;
        }
        
        .gold .plan-title h2 {
            color: var(--primary-gold);
        }
        
        .diamond .plan-title h2 {
            color: var(--diamond-blue);
        }
        
        .plan-title p {
            font-family: 'Inter', sans-serif;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }
        
        .pricing-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .original-price {
            text-decoration: line-through;
            color: rgba(255, 255, 255, 0.5);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }
        
        .current-price {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
            font-family: 'Inter', sans-serif;
        }
        
        .gold .current-price {
            color: var(--primary-gold);
        }
        
        .diamond .current-price {
            color: var(--diamond-blue);
        }
        
        .period {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .btn-purchase {
            padding: 15px;
            border-radius: var(--radius-lg);
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: 'Inter', sans-serif;
            position: relative;
            z-index: 1;
            letter-spacing: 0.5px;
        }
        
        .gold .btn-purchase {
            background: var(--gold-gradient);
            color: #1A1F3C;
        }
        
        .diamond .btn-purchase {
            background: var(--diamond-gradient);
            color: #1A1F3C;
        }
        
        /* صفحه پروفایل */
        .profile-section {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .profile-header h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-family: 'Inter', sans-serif;
        }
        
        .profile-header p {
            color: rgba(255,255,255,0.6);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }
        
        .profile-card {
            background: var(--dark-card);
            border-radius: var(--radius-xl);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .profile-item {
            display: flex;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            align-items: center;
        }
        
        .profile-item:last-child {
            border-bottom: none;
        }
        
        .profile-label {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }
        
        .profile-value {
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            color: white;
            font-weight: 500;
        }
        
        .subscription-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            margin-right: 8px;
        }
        
        .subscription-badge.gold {
            background: var(--gold-gradient);
            color: #1A1F3C;
        }
        
        .subscription-badge.diamond {
            background: var(--diamond-gradient);
            color: #1A1F3C;
        }
        
        /* نویگیشن پایین */
        /* ==================== نویگیشن مدرن گلاس مورفی ==================== */
.bottom-nav {
    position: fixed;
    bottom: 20px;
    right: 50%;
    transform: translateX(50%);
    width: 90%;
    max-width: 400px;
    background: rgba(26, 31, 60, 0.85);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-radius: 30px;
    border: 1px solid rgba(255, 215, 0, 0.25);
    padding: 12px 20px;
    z-index: 1000;
    box-shadow: 
        0 10px 40px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 215, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    height: auto;
}

.nav-container {
    width: 100%;
    margin: 0 auto;
    padding: 0;
}

.nav-items {
    display: flex;
    justify-content: space-between;
    align-items: center;
    list-style: none;
    margin: 0;
    padding: 0;
}

.nav-item {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: rgba(255, 255, 255, 0.6);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 10px 15px;
    border-radius: 20px;
    min-width: 70px;
}

.nav-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gold-gradient);
    border-radius: 20px;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
}

.nav-item:hover {
    color: #1A1F3C;
    transform: translateY(-5px);
}

.nav-item:hover::before {
    opacity: 1;
}

.nav-item.active {
    color: #1A1F3C;
    background: var(--gold-gradient);
    transform: translateY(-8px);
    box-shadow: 
        0 8px 25px rgba(255, 215, 0, 0.4),
        0 0 15px rgba(255, 215, 0, 0.2);
}

.nav-icon {
    font-size: 22px;
    margin-bottom: 6px;
    transition: transform 0.3s ease;
}

.nav-item:hover .nav-icon,
.nav-item.active .nav-icon {
    transform: scale(1.2);
}

.nav-text {
    font-size: 12px;
    font-weight: 700;
    font-family: 'Inter', sans-serif;
    letter-spacing: 0.3px;
    transition: all 0.3s ease;
}

/* افکت نور برای آیتم فعال */
.nav-item.active::after {
    content: '';
    position: absolute;
    top: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 6px;
    height: 6px;
    background: var(--diamond-blue);
    border-radius: 50%;
    box-shadow: 0 0 10px var(--diamond-blue);
    animation: pulseLight 2s infinite;
}

/* افکت هاله دور نویگیشن */
.bottom-nav::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    background: linear-gradient(45deg, 
        rgba(255, 215, 0, 0.1), 
        rgba(0, 255, 255, 0.1), 
        rgba(255, 102, 178, 0.1));
    border-radius: 35px;
    z-index: -1;
    opacity: 0.5;
    filter: blur(15px);
}

/* ==================== هندلر وسط (لامپ) ==================== */
.center-nav-item {
    position: relative;
    margin-top: -30px;
    z-index: 1001;
}

.center-nav-button {
    width: 70px;
    height: 70px;
    background: var(--gold-gradient);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    color: #1A1F3C;
    font-size: 28px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
        0 10px 30px rgba(255, 215, 0, 0.4),
        0 0 0 4px rgba(255, 215, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
    position: relative;
    overflow: hidden;
}

.center-nav-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, 
        transparent, 
        rgba(255, 255, 255, 0.3), 
        transparent);
    transform: translateX(-100%);
    transition: transform 0.6s ease;
}

.center-nav-button:hover {
    transform: translateY(-10px) scale(1.1);
    box-shadow: 
        0 15px 40px rgba(255, 215, 0, 0.6),
        0 0 0 4px rgba(255, 215, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
}

.center-nav-button:hover::before {
    transform: translateX(100%);
}

.center-nav-button.active {
    background: var(--diamond-gradient);
    transform: rotate(360deg);
    box-shadow: 
        0 15px 40px rgba(0, 255, 255, 0.6),
        0 0 20px rgba(0, 255, 255, 0.4);
}

/* ==================== انیمیشن‌های جدید ==================== */
@keyframes pulseLight {
    0%, 100% { 
        opacity: 0.7;
        transform: translateX(-50%) scale(1);
    }
    50% { 
        opacity: 1;
        transform: translateX(-50%) scale(1.3);
    }
}

@keyframes floatNav {
    0%, 100% { 
        transform: translateX(50%) translateY(0);
    }
    50% { 
        transform: translateX(50%) translateY(-10px);
    }
}

/* انیمیشن شناور برای نویگیشن */
.bottom-nav {
    animation: floatNav 6s ease-in-out infinite;
}

/* ==================== افکت‌های هاله ==================== */
.glow-effect {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 30px;
    background: radial-gradient(circle at center, 
        rgba(255, 215, 0, 0.15) 0%,
        rgba(0, 255, 255, 0.1) 50%,
        transparent 80%);
    pointer-events: none;
    z-index: -2;
}

/* رفع مشکل کندی input ها */
.form-control {
    -webkit-tap-highlight-color: transparent;
    -webkit-user-select: text;
    user-select: text;
    -webkit-appearance: none;
    appearance: none;
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
}

/* بهبود performance برای موبایل */
input, textarea, select, button {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    transform: translate3d(0, 0, 0);
}

/* رفع lag برای انیمیشن‌ها */
* {
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    -webkit-touch-callout: none;
}

/* بهبود performance برای انیمیشن‌ها */
.lamp-container, .avatar-circle, .nav-item {
    will-change: transform;
}

/* جلوگیری از reflow های غیرضروری */
.modern-profile-section {
    contain: content;
}

/* ==================== رسپانسیو ==================== */
@media (max-width: 768px) {
    .bottom-nav {
        bottom: 15px;
        width: 95%;
        padding: 10px 15px;
    }
    
    .nav-item {
        padding: 8px 10px;
        min-width: 60px;
    }
    
    .nav-icon {
        font-size: 20px;
    }
    
    .nav-text {
        font-size: 11px;
    }
    
    .center-nav-button {
        width: 60px;
        height: 60px;
        font-size: 24px;
    }
}

@media (max-width: 480px) {
    .bottom-nav {
        bottom: 10px;
        padding: 8px 10px;
        border-radius: 25px;
    }
    
    .nav-item {
        padding: 6px 8px;
        min-width: 50px;
    }
    
    .nav-icon {
        font-size: 18px;
        margin-bottom: 4px;
    }
    
    .nav-text {
        font-size: 10px;
    }
    
    .center-nav-button {
        width: 50px;
        height: 50px;
        font-size: 20px;
    }
}

/* ==================== افکت‌های تعاملی ==================== */
.ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.6);
    transform: scale(0);
    animation: ripple 0.6s linear;
    pointer-events: none;
}

@keyframes ripple {
    to {
        transform: scale(4);
        opacity: 0;
    }
}
        
        /* مودال ثبت‌نام چند مرحله‌ای جدید */
        .modal-overlay {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 15, 43, 0.98);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.2s ease;
            padding: 20px;
        }
        
        .auth-modal {
            background: var(--dark-card);
            padding: 30px;
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 420px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: modalSlideIn 0.3s ease;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }
        
        .modal-icon {
            width: 60px;
            height: 60px;
            background: var(--gold-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 24px;
            color: #1A1F3C;
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
        }
        
        .modal-header h3 {
            margin-bottom: 8px;
            font-size: 22px;
            color: #FFD700;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
        }
        
        .modal-header p {
            color: rgba(255,255,255,0.6);
            font-size: 13px;
            font-family: 'Inter', sans-serif;
        }
        
        /* پیشرفت مرحله‌ای */
        .step-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            padding: 0 15px;
        }
        
        .step-progress::before {
            content: '';
            position: absolute;
            top: 50%;
            right: 50px;
            left: 50px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-50%);
            z-index: 1;
        }
        
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.5);
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }
        
        .step.active {
            background: var(--gold-gradient);
            border-color: transparent;
            color: #1A1F3C;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            transform: scale(1.1);
        }
        
        .step.completed {
            background: rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.5);
            color: var(--primary-gold);
        }
        
        .step-text {
            position: absolute;
            top: 45px;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            white-space: nowrap;
            font-family: 'Inter', sans-serif;
        }
        
        .step-1 .step-text {
            right: -5px;
        }
        
        .step-2 .step-text {
            left: -5px;
        }
        
        /* فرم‌های چند مرحله‌ای */
        .form-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .form-step.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            font-size: 13px;
        }
        
        .form-control {
            width: 100%;
            padding: 14px;
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: rgba(255, 215, 0, 0.5);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }
        
        .password-wrapper {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            padding: 5px;
            z-index: 2;
        }
        
        /* دکمه‌های ناوبری فرم */
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            gap: 10px;
        }
        
        .btn-step {
            padding: 14px 25px;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Inter', sans-serif;
            flex: 1;
            justify-content: center;
            letter-spacing: 0.3px;
        }
        
        .btn-step-next {
            background: var(--gold-gradient);
            color: #1A1F3C;
        }
        
        .btn-step-prev {
            background: rgba(255, 255, 255, 0.07);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .btn-step:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
        }
        
        .btn-submit {
            width: 100%;
            padding: 15px;
            background: var(--gold-gradient);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 700;
            cursor: pointer;
            color: #1A1F3C;
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            margin-top: 10px;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            box-shadow: 0 6px 15px rgba(255, 215, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
        }
        
        .btn-submit:active {
            transform: translateY(0);
        }
        
        .btn-submit.loading {
            opacity: 0.8;
            cursor: not-allowed;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            color: var(--primary-gold);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .close-modal:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: rotate(90deg);
        }
        
        .error-message {
            color: var(--error-red);
            font-size: 12px;
            margin-top: 6px;
            display: none;
            font-family: 'Inter', sans-serif;
        }
        
        .success-message {
            color: var(--success-green);
            font-size: 12px;
            margin-top: 6px;
            display: none;
            font-family: 'Inter', sans-serif;
        }
        
        /* صفحه ورود (Login) */
        .login-form {
            margin-top: 20px;
        }
        
        .login-submit-btn {
            width: 100%;
            padding: 15px;
            background: var(--gold-gradient);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 700;
            cursor: pointer;
            color: #1A1F3C;
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            margin-top: 20px;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            box-shadow: 0 6px 15px rgba(255, 215, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .switch-auth-mode {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .switch-auth-btn {
            background: none;
            border: none;
            color: var(--primary-gold);
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            padding: 8px 15px;
            border-radius: var(--radius-md);
        }
        
        .switch-auth-btn:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        /* نوتیفیکیشن */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--dark-card);
            color: white;
            padding: 14px 22px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow);
            border-right: 3px solid var(--primary-gold);
            z-index: 10000;
            max-width: 300px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Inter', sans-serif;
            animation: slideIn 0.3s ease;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .notification.success {
            border-right-color: var(--success-green);
        }
        
        .notification.error {
            border-right-color: var(--error-red);
        }
        
        /* دکمه بازگشت به بالا */
        .back-to-top {
            position: fixed;
            bottom: 80px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gold-gradient);
            border: none;
            color: #1A1F3C;
            font-size: 20px;
            cursor: pointer;
            z-index: 999;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .back-to-top:hover {
            transform: translateY(-3px);
        }
        
        /* لودینگ */
        .loading {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-gold);
            animation: spin 0.8s ease-in-out infinite;
        }
        
        /* انیمیشن‌ها */
        @keyframes lampGlow {
            0%, 100% { 
                transform: scale(1);
                text-shadow: 
                    0 0 20px rgba(255, 215, 0, 0.6),
                    0 0 40px rgba(255, 215, 0, 0.4);
            }
            50% { 
                transform: scale(1.05);
                text-shadow: 
                    0 0 25px rgba(255, 215, 0, 0.8),
                    0 0 50px rgba(255, 215, 0, 0.6);
            }
        }
        
        @keyframes glowPulse {
            0%, 100% { 
                opacity: 0.3; 
                transform: scale(0.95);
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.05);
            }
        }
        
        @keyframes circlePulse {
            0%, 100% { 
                transform: scale(1);
                border-color: rgba(255, 215, 0, 0.2);
            }
            50% { 
                transform: scale(1.03);
                border-color: rgba(255, 215, 0, 0.4);
            }
        }
        
        @keyframes rotateClockwise {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes rotateCounterClockwise {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(-360deg); }
        }
        
        @keyframes particleFloat {
            0% { 
                opacity: 0;
                transform: translate(0, 0) scale(0.5);
            }
            10% { opacity: 1; }
            50% { transform: translate(var(--tx), var(--ty)) scale(1.2); }
            90% { opacity: 1; }
            100% { 
                opacity: 0;
                transform: translate(calc(var(--tx) * 2), calc(var(--ty) * 2)) scale(0.5);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { 
                transform: translateX(100%);
                opacity: 0;
            }
            to { 
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ریسپانسیو */
        @media (max-width: 768px) {
            .header-content {
                padding: 0 15px;
            }
            
            .logo {
                font-size: 28px;
            }
            
            .lamp-container {
                width: 180px;
                height: 180px;
            }
            
            .lamp-icon {
                font-size: 90px;
            }
            
            .orbit-1 {
                width: 200px;
                height: 200px;
            }
            
            .orbit-2 {
                width: 220px;
                height: 220px;
            }
            
            .welcome-text h1 {
                font-size: 28px;
            }
            
            .welcome-text p {
                font-size: 14px;
            }
            
            .btn {
                padding: 14px 30px;
                font-size: 15px;
            }
            
            .plan-card {
                padding: 20px;
            }
            
            .user-name {
                display: none;
            }
            
            .auth-modal {
                padding: 25px;
                margin: 15px;
                max-width: 380px;
            }
        }
        
        @media (max-width: 480px) {
            .lamp-container {
                width: 150px;
                height: 150px;
            }
            
            .lamp-icon {
                font-size: 70px;
            }
            
            .orbit-1 {
                width: 170px;
                height: 170px;
            }
            
            .orbit-2 {
                width: 190px;
                height: 190px;
            }
            
            .welcome-text h1 {
                font-size: 24px;
            }
            
            .nav-item {
                padding: 6px 8px;
            }
            
            .nav-text {
                font-size: 10px;
            }
            
            .nav-icon {
                font-size: 18px;
            }
            
            .back-to-top {
                bottom: 70px;
                left: 15px;
                width: 45px;
                height: 45px;
            }
            
            .auth-modal {
                padding: 20px;
                max-width: 340px;
            }
            
            .profile-card {
                padding: 20px;
            }
            
            .step {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
            
            .step-text {
                font-size: 10px;
                top: 40px;
            }
        }
        /* استایل جدید برای متن بالای صفحه */
.animated-text-top {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    font-family: 'Playfair Display', serif;
    font-size: 18px;
    font-weight: 700;
    background: linear-gradient(90deg, #FFD700, #00FFFF, #FF66B2);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: slideText 3s infinite alternate ease-in-out;
    white-space: nowrap;
    padding: 10px 20px;
    z-index: 5;
    width: auto;
    background-color: rgba(10, 15, 43, 0.7);
    backdrop-filter: blur(5px);
    border-radius: 20px;
    border: 1px solid rgba(255, 215, 0, 0.2);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

/* ========== استایل‌های پروفایل مدرن ========== */

.modern-profile-section {
    position: relative;
    min-height: 100%;
    padding: 20px;
    overflow: hidden;
}

/* هدر پروفایل */
.modern-profile-header {
    text-align: center;
    padding: 30px 20px;
    margin-bottom: 30px;
    position: relative;
    background: linear-gradient(135deg, 
        rgba(26, 31, 60, 0.9) 0%,
        rgba(10, 15, 43, 0.8) 100%);
    border-radius: 25px;
    border: 1px solid rgba(255, 215, 0, 0.1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.profile-avatar-container {
    position: relative;
    z-index: 2;
}

.avatar-circle {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #1A1F3C 0%, #2A2F5C 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 42px;
    color: #FFD700;
    margin: 0 auto 20px;
    border: 3px solid rgba(255, 215, 0, 0.3);
    box-shadow: 
        0 0 30px rgba(255, 215, 0, 0.2),
        inset 0 0 20px rgba(0, 0, 0, 0.3);
    position: relative;
}

.avatar-circle::after {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    border: 2px solid transparent;
    border-radius: 50%;
    background: linear-gradient(135deg, #FFD700, #00FFFF) border-box;
    -webkit-mask: 
        linear-gradient(#fff 0 0) padding-box, 
        linear-gradient(#fff 0 0);
    mask: 
        linear-gradient(#fff 0 0) padding-box, 
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: destination-out;
    mask-composite: exclude;
    animation: ringRotate 8s linear infinite;
}

@keyframes ringRotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.modern-profile-header h1 {
    font-size: 26px;
    font-weight: 700;
    margin-bottom: 10px;
    background: linear-gradient(90deg, #FFD700, #FFAA00);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    font-family: 'Playfair Display', serif;
}

.user-status {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(81, 207, 102, 0.1);
    padding: 6px 15px;
    border-radius: 20px;
    border: 1px solid rgba(81, 207, 102, 0.2);
}

.status-dot {
    width: 8px;
    height: 8px;
    background: #51cf66;
    border-radius: 50%;
    animation: statusPulse 2s infinite;
}

@keyframes statusPulse {
    0%, 100% { 
        opacity: 1; 
        box-shadow: 0 0 0 0 rgba(81, 207, 102, 0.4);
    }
    50% { 
        opacity: 0.8; 
        box-shadow: 0 0 0 5px rgba(81, 207, 102, 0);
    }
}

.status-text {
    color: #51cf66;
    font-size: 13px;
    font-weight: 600;
    font-family: 'Inter', sans-serif;
}

/* محتوای اصلی */
.modern-profile-content {
    max-width: 600px;
    margin: 0 auto;
}

/* کارت‌ها */
.profile-card {
    background: rgba(26, 31, 60, 0.7);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 
        0 10px 25px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.profile-card:hover {
    transform: translateY(-3px);
    border-color: rgba(255, 215, 0, 0.2);
    box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.profile-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
        rgba(255, 215, 0, 0.03) 0%,
        rgba(0, 255, 255, 0.02) 100%);
    pointer-events: none;
}

/* هدر کارت */
.card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 25px;
    position: relative;
    z-index: 1;
}

.header-icon {
    width: 40px;
    height: 40px;
    background: rgba(255, 215, 0, 0.1);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #FFD700;
    font-size: 16px;
}

.card-header h3 {
    font-size: 18px;
    font-weight: 600;
    color: white;
    margin: 0;
    flex: 1;
    font-family: 'Inter', sans-serif;
}

/* لیست اطلاعات */
.info-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
}

.info-item:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 215, 0, 0.1);
}

.info-label {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: 'Inter', sans-serif;
}

.info-value {
    font-size: 15px;
    color: white;
    font-weight: 600;
    font-family: 'Inter', sans-serif;
}

/* کارت اشتراک */
.subscription-card {
    background: linear-gradient(135deg, 
        rgba(26, 31, 60, 0.8) 0%,
        rgba(10, 15, 43, 0.8) 100%);
    border: 1px solid rgba(255, 215, 0, 0.15);
}

.subscription-badge {
    padding: 4px 12px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.badge-text {
    font-size: 11px;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.8);
    font-family: 'Inter', sans-serif;
}

.subscription-content {
    position: relative;
    z-index: 1;
}

.subscription-type {
    font-size: 16px;
    font-weight: 600;
    color: #FFD700;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: 'Inter', sans-serif;
}

.subscription-desc {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.6);
    margin-bottom: 20px;
    font-family: 'Inter', sans-serif;
}

.subscription-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.subscription-actions .btn {
    flex: 1;
    min-width: 140px;
    padding: 12px 20px;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

/* دکمه خروج */
.logout-section {
    margin-top: 30px;
    text-align: center;
}

.logout-btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, #FF6B6B 0%, #FF4757 100%);
    border: none;
    border-radius: 15px;
    color: white;
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.3s ease;
    font-family: 'Inter', sans-serif;
}

.logout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
}

/* افکت‌های زیبا */
.profile-effects {
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
}

.effect-circle {
    position: absolute;
    border-radius: 50%;
    filter: blur(40px);
    opacity: 0.2;
    animation: floatEffect 20s infinite ease-in-out;
}

.effect-circle.gold {
    width: 150px;
    height: 150px;
    background: #FFD700;
    top: 20%;
    left: 10%;
    animation-delay: 0s;
}

.effect-circle.blue {
    width: 120px;
    height: 120px;
    background: #00FFFF;
    bottom: 30%;
    right: 15%;
    animation-delay: 5s;
}

.effect-circle.pink {
    width: 100px;
    height: 100px;
    background: #FF66B2;
    top: 50%;
    right: 20%;
    animation-delay: 10s;
}

@keyframes floatEffect {
    0%, 100% { 
        transform: translate(0, 0) scale(1); 
    }
    25% { 
        transform: translate(20px, -15px) scale(1.1); 
    }
    50% { 
        transform: translate(-15px, 20px) scale(0.9); 
    }
    75% { 
        transform: translate(25px, 15px) scale(1.05); 
    }
}

/* رسپانسیو */
@media (max-width: 768px) {
    .modern-profile-section {
        padding: 15px;
    }
    
    .modern-profile-header {
        padding: 25px 15px;
        margin-bottom: 20px;
    }
    
    .avatar-circle {
        width: 90px;
        height: 90px;
        font-size: 36px;
    }
    
    .modern-profile-header h1 {
        font-size: 22px;
    }
    
    .profile-card {
        padding: 20px;
    }
    
    .info-item {
        padding: 12px;
    }
    
    .subscription-actions {
        flex-direction: column;
    }
    
    .subscription-actions .btn {
        min-width: 100%;
    }
}

@media (max-width: 480px) {
    .modern-profile-header {
        padding: 20px 10px;
    }
    
    .avatar-circle {
        width: 80px;
        height: 80px;
        font-size: 32px;
    }
    
    .modern-profile-header h1 {
        font-size: 20px;
    }
    
    .card-header {
        flex-wrap: wrap;
    }
    
    .info-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
}

/* آواتار دایره‌ای زیبا */
.avatar-circle {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #FFD700 0%, #FFAA00 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 42px;
    color: #1A1F3C;
    margin: 0 auto 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    box-shadow: 
        0 0 40px rgba(255, 215, 0, 0.4),
        inset 0 0 20px rgba(255, 255, 255, 0.2);
    position: relative;
    transition: all 0.3s ease;
}

.avatar-circle:hover {
    transform: scale(1.05);
    box-shadow: 
        0 0 50px rgba(255, 215, 0, 0.6),
        inset 0 0 25px rgba(255, 255, 255, 0.3);
}

.avatar-circle::after {
    content: '';
    position: absolute;
    top: -6px;
    left: -6px;
    right: -6px;
    bottom: -6px;
    border: 2px solid transparent;
    border-radius: 50%;
    background: linear-gradient(135deg, #FFD700, #00FFFF) border-box;
    -webkit-mask: 
        linear-gradient(#fff 0 0) padding-box, 
        linear-gradient(#fff 0 0);
    mask: 
        linear-gradient(#fff 0 0) padding-box, 
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: destination-out;
    mask-composite: exclude;
    animation: ringRotate 8s linear infinite;
}

/* استایل‌های بدج */
.badge-text.gold {
    color: #FFD700;
    background: rgba(255, 215, 0, 0.1);
    padding: 4px 12px;
    border-radius: 15px;
    border: 1px solid rgba(255, 215, 0, 0.3);
}

.badge-text.diamond {
    color: #00FFFF;
    background: rgba(0, 255, 255, 0.1);
    padding: 4px 12px;
    border-radius: 15px;
    border: 1px solid rgba(0, 255, 255, 0.3);
}

/* دکمه خروج */
.logout-btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, #FF6B6B 0%, #FF4757 100%);
    border: none;
    border-radius: 15px;
    color: white;
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.3s ease;
    font-family: 'Inter', sans-serif;
}

.logout-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(255, 107, 107, 0.4);
}

.logout-btn:active {
    transform: translateY(-1px);
}
/* ==================== پروژه‌ها ==================== */
#projectsTab { display: none; }
#projectsTab.active { display: block; }

.projects-section {
    padding: 30px 20px;
    max-width: 1400px;
    margin: 0 auto;
}

.projects-header {
    text-align: center;
    margin-bottom: 40px;
}

.projects-title {
    font-size: 36px;
    font-weight: 900;
    margin-bottom: 15px;
    background: linear-gradient(90deg, #FFD700, #00FFFF);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    font-family: 'Playfair Display', serif;
}

.projects-subtitle {
    color: rgba(255, 255, 255, 0.7);
    font-size: 16px;
    margin-bottom: 30px;
}

.projects-filter {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 40px;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 12px 25px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 50px;
    color: rgba(255, 255, 255, 0.9);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.filter-btn:hover {
    background: rgba(255, 215, 0, 0.1);
    border-color: rgba(255, 215, 0, 0.3);
    transform: translateY(-2px);
}

.filter-btn.active {
    background: linear-gradient(135deg, #FFD700, #FFAA00);
    color: #1A1F3C;
    border-color: transparent;
    box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
}

.projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 30px;
    margin-bottom: 50px;
}

.project-card {
    background: linear-gradient(135deg, 
        rgba(26, 31, 60, 0.9) 0%, 
        rgba(10, 15, 43, 0.9) 100%);
    border-radius: 25px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    cursor: pointer;
    animation: fadeIn 0.5s ease;
}

.project-card:hover {
    transform: translateY(-10px);
    border-color: rgba(255, 215, 0, 0.3);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.project-image {
    height: 220px;
    overflow: hidden;
    position: relative;
}

.project-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.project-card:hover .project-image img {
    transform: scale(1.1);
}

.project-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    backdrop-filter: blur(10px);
    border: 1px solid;
}

.status-completed {
    background: rgba(81, 207, 102, 0.2);
    color: #51cf66;
    border-color: rgba(81, 207, 102, 0.3);
}

.status-inprogress {
    background: rgba(0, 123, 255, 0.2);
    color: #339af0;
    border-color: rgba(0, 123, 255, 0.3);
}

.status-upcoming {
    background: rgba(255, 107, 107, 0.2);
    color: #ff6b6b;
    border-color: rgba(255, 107, 107, 0.3);
}

.project-content {
    padding: 25px;
}

.project-title {
    font-size: 20px;
    font-weight: 700;
    color: white;
    margin-bottom: 12px;
    line-height: 1.4;
}

.project-description {
    color: rgba(255, 255, 255, 0.7);
    font-size: 14px;
    line-height: 1.6;
    margin-bottom: 20px;
    height: 60px;
    overflow: hidden;
}

.project-dates {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
}

.date-box {
    flex: 1;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.date-label {
    font-size: 11px;
    color: rgba(255, 255, 255, 0.5);
    margin-bottom: 5px;
}

.date-value {
    font-size: 14px;
    color: white;
    font-weight: 500;
}

.project-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.info-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: rgba(255, 255, 255, 0.7);
}

.info-item i {
    color: #FFD700;
}

/* مودال */
.project-modal {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    background: rgba(10, 15, 43, 0.95);
    z-index: 3000;
    display: none;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

.modal-content {
    background: linear-gradient(135deg, 
        rgba(26, 31, 60, 0.95) 0%, 
        rgba(10, 15, 43, 0.95) 100%);
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    border-radius: 25px;
    overflow: hidden;
    border: 1px solid rgba(255, 215, 0, 0.2);
    box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
}

.modal-header {
    padding: 25px 30px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-title {
    font-size: 24px;
    font-weight: 700;
    color: #FFD700;
    margin: 0;
}

.close-modal {
    background: rgba(255, 215, 0, 0.1);
    border: 1px solid rgba(255, 215, 0, 0.2);
    color: #FFD700;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 20px;
    transition: all 0.3s ease;
}

.close-modal:hover {
    background: rgba(255, 215, 0, 0.2);
    transform: rotate(90deg);
}

.modal-body {
    padding: 30px;
    overflow-y: auto;
    max-height: 60vh;
}

.modal-description {
    color: rgba(255, 255, 255, 0.9);
    line-height: 1.8;
    font-size: 15px;
    margin-bottom: 30px;
}

.modal-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.modal-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-label {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
    margin-bottom: 8px;
}

.modal-value {
    font-size: 14px;
    color: white;
    font-weight: 500;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* رسپانسیو */
@media (max-width: 768px) {
    .projects-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
    }
    
    .modal-details {
        grid-template-columns: 1fr;
    }
    
    .project-dates {
        flex-direction: column;
    }
}

@media (max-width: 480px) {
    .projects-grid {
        grid-template-columns: 1fr;
    }
    
    .projects-filter {
        flex-direction: column;
        align-items: center;
    }
    
    .filter-btn {
        width: 100%;
        max-width: 200px;
    }
}
/* ==================== هدر شیک و مدرن (فقط ظاهر) ==================== */

.elegant-header {
    background: rgba(16, 20, 40, 0.95);
    backdrop-filter: blur(25px) saturate(180%);
    -webkit-backdrop-filter: blur(25px) saturate(180%);
    border-bottom: 1px solid rgba(255, 215, 0, 0.1);
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    z-index: 1000;
    padding: 0;
    height: 65px;
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.header-content {
    max-width: 1300px;
    margin: 0 auto;
    padding: 0 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 100%;
    position: relative;
}

/* خط نورانی زیر هدر */
.elegant-header::after {
    content: '';
    position: absolute;
    bottom: 0;
    right: 0;
    width: 100%;
    height: 1px;
    background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 215, 0, 0.3) 50%, 
        transparent 100%);
}

/* لوگو کوچک و مدرن */
.logo {
    font-family: 'Playfair Display', serif;
    font-size: 36px !important; /* کوچکتر */
    font-weight: 800;
    background: linear-gradient(135deg, #FFD700 0%, #FFAA00 50%, #FFD700 100%);
    background-size: 200% auto;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow: 
        0 2px 15px rgba(255, 215, 0, 0.25),
        0 0 0 rgba(255, 215, 0, 0);
    letter-spacing: 1.5px;
    position: relative;
    padding: 8px 0;
    transition: all 0.4s ease;
    animation: goldShine 3s infinite linear;
}

@keyframes goldShine {
    0% { background-position: 0% center; }
    100% { background-position: 200% center; }
}

.logo:hover {
    transform: translateY(-1px);
    text-shadow: 
        0 4px 20px rgba(255, 215, 0, 0.4),
        0 0 20px rgba(255, 215, 0, 0.2);
}

/* آیکون کاربر شیک */
.user-icon {
    width: 40px; /* کمی کوچکتر */
    height: 40px;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 12px; /* گوشه‌های نرم */
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.8);
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(255, 255, 255, 0.08);
    position: relative;
    overflow: hidden;
}

/* افکت شیشه‌ای */
.user-icon::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.1) 0%,
        transparent 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.user-icon:hover {
    background: rgba(255, 255, 255, 0.12);
    border-color: rgba(255, 215, 0, 0.3);
    transform: translateY(-2px);
    box-shadow: 
        0 6px 20px rgba(255, 215, 0, 0.15),
        0 0 0 1px rgba(255, 215, 0, 0.1);
}

.user-icon:hover::before {
    opacity: 1;
}

.user-icon.logged-in {
    background: linear-gradient(135deg, 
        rgba(255, 215, 0, 0.2) 0%,
        rgba(255, 170, 0, 0.1) 100%);
    border-color: rgba(255, 215, 0, 0.4);
    color: #FFD700;
    box-shadow: 
        0 4px 15px rgba(255, 215, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

.user-icon.logged-in:hover {
    background: linear-gradient(135deg, 
        rgba(255, 215, 0, 0.3) 0%,
        rgba(255, 170, 0, 0.2) 100%);
    box-shadow: 
        0 8px 25px rgba(255, 215, 0, 0.3),
        0 0 0 1px rgba(255, 215, 0, 0.2);
}

/* نقطه وضعیت */
.user-icon::after {
    content: '';
    position: absolute;
    bottom: 5px;
    left: 5px;
    width: 8px;
    height: 8px;
    background: #ff6b6b;
    border-radius: 50%;
    border: 2px solid rgba(16, 20, 40, 0.9);
    transition: all 0.3s ease;
    opacity: 0.8;
}

.user-icon.logged-in::after {
    background: #51cf66;
    opacity: 1;
    box-shadow: 0 0 10px rgba(81, 207, 102, 0.5);
}

/* نام کاربر در هدر */
.user-name {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.9);
    font-family: 'Inter', sans-serif;
    font-weight: 500;
    display: none; /* فعلاً مخفی */
}

.user-status {
    display: flex;
    align-items: center;
    gap: 8px;
}

/* افکت نور پشت لوگو (اختیاری) */
.logo-glow {
    position: absolute;
    top: 50%;
    right: -10px;
    transform: translateY(-50%);
    width: 60px;
    height: 60px;
    background: radial-gradient(circle, 
        rgba(255, 215, 0, 0.15) 0%,
        rgba(255, 215, 0, 0.05) 50%,
        transparent 70%);
    filter: blur(10px);
    z-index: -1;
    opacity: 0.5;
}

/* رسپانسیو */
@media (max-width: 768px) {
    .header-content {
        padding: 0 20px;
    }
    
    .logo {
        font-size: 22px !important;
        letter-spacing: 1px;
    }
    
    .user-icon {
        width: 36px;
        height: 36px;
        font-size: 15px;
        border-radius: 10px;
    }
}

@media (max-width: 480px) {
    .elegant-header {
        height: 60px;
    }
    
    .header-content {
        padding: 0 15px;
    }
    
    .logo {
        font-size: 20px !important;
    }
    
    .user-icon {
        width: 34px;
        height: 34px;
        font-size: 14px;
    }
    
    .user-icon::after {
        width: 6px;
        height: 6px;
        bottom: 4px;
        left: 4px;
    }
}
    </style>
</head>
<body>
    <!-- هدر -->
    <header class="elegant-header">
        <div class="header-content">
            <div class="logo">SPS</div>
            <div class="user-status">
                <span class="user-name" id="userNameDisplay"></span>
                <div class="user-icon" id="userIcon">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </div>
    </header>
    
    <!-- محتوای اصلی -->
    <div class="main-container">
        <!-- صفحه اصلی -->
        <div id="homeTab" class="tab-content active">
            <section class="home-page">
              <div class="animated-text-top">⚡ تجربه ای نوین در زندگی مدرن ⚡</div>
                <div class="lamp-container">
                    <div class="main-circle"></div>
                    <div class="rotating-orbit orbit-1"></div>
                    <div class="rotating-orbit orbit-2"></div>
                    <i class="fas fa-lightbulb lamp-icon"></i>
                    <div class="lamp-glow"></div>
                </div>
                
                <div class="welcome-text">
                    <h1>خدمات برقی هوشمند SPS</h1>
                    <p>با بیش از ۱۵ سال تجربه و کادری مجرب</p>
                </div>
                
                <div class="auth-button" id="authButtonContainer">
                    <button class="btn btn-primary" id="loginBtn">
                        <i class="fas fa-sign-in-alt"></i>
                        پروفایل کاربری
                    </button>
                </div>
            </section>
        </div>
        
        <!-- تب طلایی -->
        <div id="goldTab" class="tab-content">
            <div class="plan-card gold">
                <div class="discount-badge">۵۰٪ تخفیف</div>
                
                <div class="card-header">
                    <div class="plan-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="plan-title">
                        <h2>طلایی</h2>
                        <p>پیشنهاد ویژه سالانه</p>
                    </div>
                </div>
                
                <div class="pricing-section">
                    <div class="original-price">5,000,000 تومان</div>
                    <div class="current-price">2,490,000</div>
                    <div class="period">اشتراک ۱۲ ماهه</div>
                </div>
                
                <div class="features-list">
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <i class="fas fa-check" style="color: #FFD700;"></i>
                            <span>لوازم جانبی و خدمات پس از فروش</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <i class="fas fa-check" style="color: #FFD700;"></i>
                            <span> بازدید و مشاوره رایگان</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-check" style="color: #FFD700;"></i>
                            <span>پشتیبانی تلفنی</span>
                        </div>
                    </div>
                </div>
                
                <button class="btn-purchase" id="goldPurchaseBtn">
                    <i class="fas fa-shopping-cart"></i>
                    خرید اشتراک طلایی
                </button>
            </div>
        </div>
        
        <!-- تب الماس -->
        <div id="diamondTab" class="tab-content">
            <div class="plan-card diamond">
                <div class="discount-badge">۶۰٪ تخفیف</div>
                
                <div class="card-header">
                    <div class="plan-icon">
                        <i class="fas fa-gem"></i>
                    </div>
                    <div class="plan-title">
                        <h2>الماس</h2>
                        <p>پیشنهاد ویژه ویژه</p>
                    </div>
                </div>
                
                <div class="pricing-section">
                    <div class="original-price">10,000,000 تومان</div>
                    <div class="current-price">4,490,000</div>
                    <div class="period">اشتراک ۱۲ ماهه</div>
                </div>
                
                <div class="features-list">
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <i class="fas fa-check" style="color: #00FFFF;"></i>
                            <span>کارت خرید از فروشگاه های تحت پوشش</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <i class="fas fa-check" style="color: #00FFFF;"></i>
                            <span>کسب درآمد از SPS</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-check" style="color: #00FFFF;"></i>
                            <span>پشتیبانی ۲۴/۷</span>
                        </div>
                    </div>
                </div>
                
                <button class="btn-purchase" id="diamondPurchaseBtn">
                    <i class="fas fa-gem"></i>
                    خرید اشتراک الماس
                </button>
            </div>
        </div>
        
        <!-- در main-container، بعد از تب home -->
<div id="projectsTab" class="tab-content">
    <section class="projects-section">
        <div class="projects-header">
            <h1 class="projects-title">پروژه‌های ما</h1>
            <p class="projects-subtitle">نمونه کارهای موفق با بالاترین استانداردها</p>
            
            <div class="projects-filter">
                <button class="filter-btn active" onclick="filterProjects('all')">همه پروژه‌ها</button>
                <button class="filter-btn" onclick="filterProjects('مسکونی')">مسکونی</button>
                <button class="filter-btn" onclick="filterProjects('تجاری')">تجاری</button>
                <button class="filter-btn" onclick="filterProjects('صنعتی')">صنعتی</button>
                <button class="filter-btn" onclick="filterProjects('عمومی')">عمومی</button>
            </div>
        </div>
        
        <div class="projects-grid" id="projectsGrid">
            <!-- پروژه‌ها اینجا لود می‌شوند -->
        </div>
    </section>
</div>

<!-- مودال -->
<div class="project-modal" id="projectModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="modalProjectTitle">عنوان پروژه</h3>
            <button class="close-modal" id="closeModal">×</button>
        </div>
        <div class="modal-body">
            <div class="modal-description" id="modalProjectDescription">
                توضیحات پروژه...
            </div>
            <div class="modal-details">
                <div class="modal-item">
                    <div class="modal-label">تاریخ شروع</div>
                    <div class="modal-value" id="modalStartDate">-</div>
                </div>
                <div class="modal-item">
                    <div class="modal-label">تاریخ پایان</div>
                    <div class="modal-value" id="modalEndDate">-</div>
                </div>
                <div class="modal-item">
                    <div class="modal-label">دسته‌بندی</div>
                    <div class="modal-value" id="modalCategory">-</div>
                </div>
                <div class="modal-item">
                    <div class="modal-label">وضعیت</div>
                    <div class="modal-value" id="modalStatus">-</div>
                </div>
                <div class="modal-item">
                    <div class="modal-label">مکان</div>
                    <div class="modal-value" id="modalLocation">-</div>
                </div>
                <div class="modal-item">
                    <div class="modal-label">کارفرما</div>
                    <div class="modal-value" id="modalClient">-</div>
                </div>
            </div>
        </div>
    </div>
</div>
        
        <!-- ========== پروفایل کاربری مدرن و ساده ========== -->
<div id="profileTab" class="tab-content">
    <section class="modern-profile-section">
        <!-- هدر پروفایل -->
        <div class="modern-profile-header">
            <div class="profile-avatar-container">
                <div class="avatar-circle" id="userAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <h1 id="modernProfileName">کاربر مهمان</h1>
                <div class="user-status">
                    <span class="status-dot"></span>
                    <span class="status-text" id="userStatusText">آنلاین</span>
                </div>
            </div>
        </div>
        
        <!-- محتوای اصلی -->
        <div class="modern-profile-content">
            <!-- کارت اطلاعات کاربر -->
            <div class="profile-card glass-card">
                <div class="card-header">
                    <div class="header-icon">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <h3>اطلاعات حساب کاربری</h3>
                </div>
                
                <div class="info-list">
                    <div class="info-item">
                        <div class="info-label">
                            <i class="fas fa-user-tag"></i>
                            نام کاربری
                        </div>
                        <div class="info-value" id="modernUsername">کاربر مهمان</div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">
                            <i class="fas fa-envelope"></i>
                            ایمیل
                        </div>
                        <div class="info-value" id="modernEmail">ثبت‌نام نکرده‌اید</div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">
                            <i class="fas fa-phone"></i>
                            شماره تماس
                        </div>
                        <div class="info-value" id="modernPhone">ندارید</div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">
                            <i class="fas fa-calendar-alt"></i>
                            تاریخ ثبت‌نام
                        </div>
                        <div class="info-value" id="modernCreatedAt">-</div>
                    </div>
                </div>
            </div>
            
            <!-- کارت اشتراک (ساده‌تر) -->
            <div class="profile-card glass-card subscription-card">
                <div class="card-header">
                    <div class="header-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <h3>اشتراک فعال</h3>
                    <div class="subscription-badge" id="subscriptionBadge">
                        <span class="badge-text">بدون اشتراک</span>
                    </div>
                </div>
                
                <div class="subscription-content">
                    <div class="subscription-type" id="modernSubscriptionType">
                        <i class="fas fa-times-circle"></i>
                        هیچ اشتراکی فعال نیست
                    </div>
                    <p class="subscription-desc">برای دسترسی به امکانات ویژه، به بخش اشتراک‌ها مراجعه کنید</p>
                </div>
            </div>
            
            <!-- دکمه خروج -->
            <div class="logout-section" style="display: none;" id="logoutSection">
                <button class="logout-btn" id="modernLogoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    خروج از حساب کاربری
                </button>
            </div>
        </div>
        
        <!-- افکت‌های زیبا -->
        <div class="profile-effects">
            <div class="effect-circle gold"></div>
            <div class="effect-circle blue"></div>
            <div class="effect-circle pink"></div>
        </div>
    </section>
</div>
    
    <!-- نویگیشن پایین -->
    <!-- نویگیشن مدرن گلاس مورفی -->
<nav class="bottom-nav">
    <div class="glow-effect"></div>
    <div class="nav-container">
        <ul class="nav-items">
            <li>
                <a href="#" class="nav-item active" data-tab="home">
                    <i class="fas fa-home nav-icon"></i>
                    <span class="nav-text">خانه</span>
                </a>
            </li>
            <li>
                <a href="#" class="nav-item" data-tab="gold">
                    <i class="fas fa-crown nav-icon"></i>
                    <span class="nav-text">طلایی</span>
                </a>
            </li>
            
            <!-- دکمه مرکزی ویژه -->
            <li class="center-nav-item">
                <button class="center-nav-button" id="centerNavButton">
                    <i class="fas fa-bolt"></i>
                </button>
            </li>
            
            <li>
                <a href="#" class="nav-item" data-tab="diamond">
                    <i class="fas fa-gem nav-icon"></i>
                    <span class="nav-text">الماس</span>
                </a>
            </li>
            <li>
                <a href="#" class="nav-item" data-tab="profile">
                    <i class="fas fa-user nav-icon"></i>
                    <span class="nav-text">پروفایل</span>
                </a>
            </li>
        </ul>
    </div>
</nav>
    
    <!-- مودال ثبت‌نام/ورود چند مرحله‌ای جدید -->
    <div class="modal-overlay" id="authModal">
        <div class="auth-modal">
            <button class="close-modal" id="closeModal">×</button>
            
            <!-- فرم ثبت‌نام چند مرحله‌ای -->
            <div id="registerWizard">
                <div class="modal-header">
                    <div class="modal-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <h3>ایجاد حساب جدید</h3>
                    <p>مراحل ثبت‌نام را تکمیل کنید</p>
                </div>
                
                <!-- پیشرفت مرحله‌ای -->
                <div class="step-progress">
                    <div class="step step-1 active">
                        <span>۱</span>
                        <div class="step-text">اطلاعات شخصی</div>
                    </div>
                    <div class="step step-2">
                        <span>۲</span>
                        <div class="step-text">اطلاعات حساب</div>
                    </div>
                </div>
                
                <!-- مرحله ۱: اطلاعات شخصی -->
                <form id="registerStep1" class="form-step active">
                    <div class="form-group">
                        <label for="fullName">نام و نام خانوادگی</label>
                        <input type="text" id="fullName" class="form-control" placeholder="علی محمدی" required>
                        <div class="error-message" id="fullNameError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">شماره موبایل</label>
                        <input type="tel" id="phone" class="form-control" placeholder="۰۹۱۲۳۴۵۶۷۸۹" required>
                        <div class="error-message" id="phoneError"></div>
                        <div class="success-message" id="phoneSuccess"></div>
                    </div>
                    
                    <div class="form-navigation">
                        <button type="button" class="btn-step btn-step-next" id="nextStep1">
                            <i class="fas fa-arrow-left"></i>
                            مرحله بعد
                        </button>
                    </div>
                </form>
                
                <!-- مرحله ۲: اطلاعات حساب -->
                <form id="registerStep2" class="form-step">
                    <div class="form-group">
                        <label for="email">ایمیل</label>
                        <input type="email" id="email" class="form-control" placeholder="example@email.com" required>
                        <div class="error-message" id="emailError"></div>
                        <div class="success-message" id="emailSuccess"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="registerPassword">رمز عبور</label>
                        <div class="password-wrapper">
                            <input type="password" id="registerPassword" class="form-control" placeholder="حداقل ۶ کاراکتر" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('registerPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="error-message" id="passwordError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">تکرار رمز عبور</label>
                        <div class="password-wrapper">
                            <input type="password" id="confirmPassword" class="form-control" placeholder="رمز عبور را تکرار کنید" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('confirmPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="error-message" id="confirmPasswordError"></div>
                    </div>
                    
                    <div class="form-navigation">
                        <button type="button" class="btn-step btn-step-prev" id="prevStep2">
                            <i class="fas fa-arrow-right"></i>
                            قبل
                        </button>
                        
                        <button type="submit" class="btn-submit" id="registerSubmitBtn">
                            <i class="fas fa-user-plus"></i>
                            ایجاد حساب
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- فرم ورود (ساده) -->
            <div id="loginFormContainer" style="display: none;">
                <div class="modal-header">
                    <div class="modal-icon">
                        <i class="fas fa-sign-in-alt"></i>
                    </div>
                    <h3>ورود به حساب</h3>
                    <p>اطلاعات حساب خود را وارد کنید</p>
                </div>
                
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label>ایمیل یا موبایل</label>
                        <input type="text" id="loginIdentifier" class="form-control" placeholder="example@email.com یا ۰۹۱۲۳۴۵۶۷۸۹" required>
                        <div class="error-message" id="loginIdentifierError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">رمز عبور</label>
                        <div class="password-wrapper">
                            <input type="password" id="loginPassword" class="form-control" placeholder="رمز عبور خود را وارد کنید" required>
                            <button type="button" class="toggle-password" onclick="togglePassword('loginPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="error-message" id="loginPasswordError"></div>
                    </div>
                    
                    <button type="submit" class="login-submit-btn" id="loginSubmitBtn">
                        <i class="fas fa-sign-in-alt"></i>
                        ورود به حساب
                    </button>
                </form>
                
                <div class="switch-auth-mode">
                    <span style="color: rgba(255,255,255,0.6); font-size: 13px;">حساب کاربری ندارید؟</span>
                    <button class="switch-auth-btn" id="switchToRegister">
                        ثبت‌نام کنید
                    </button>
                </div>
            </div>
            
            <!-- سوئیچ بین ثبت‌نام و ورود (در پایین فرم ثبت‌نام) -->
            <div class="switch-auth-mode" id="registerSwitch" style="display: none;">
                <span style="color: rgba(255,255,255,0.6); font-size: 13px;">قبلاً حساب دارید؟</span>
                <button class="switch-auth-btn" id="switchToLogin">
                    ورود به حساب
                </button>
            </div>
        </div>
    </div>
    
    <!-- دکمه بازگشت به بالا -->
    <button id="backToTop" class="back-to-top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <script>
        // ==================== SUPABASE CONFIGURATION ====================
        const SUPABASE_URL = 'https://pigdpbfqrxpocmzyyfsr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpZ2RwYmZxcnhwb2Ntenl5ZnNyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjUxMjIxMiwiZXhwIjoyMDgyMDg4MjEyfQ.RzhdhSnwi4WM1JP6U_jYQvJD9ztrpGNce6Nbhnr-oOM';
        
        // ایجاد کلاینت Supabase
        if (typeof window.supabaseClient === 'undefined') {
            var supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            window.supabaseClient = supabase;
        } else {
            var supabase = window.supabaseClient;
        }
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 SPS Application Initializing...');
            
            // ایجاد ذرات انرژی
            createEnergyParticles();
            
            // راه‌اندازی رویدادها
            setupEventListeners();
            
            // دکمه بازگشت به بالا
            setupBackToTop();
            
            // بررسی اتصال Supabase و وضعیت ورود
            try {
                await checkSupabaseConnection();
                await checkAuthStatus();
            } catch (error) {
                console.error('Initialization error:', error);
            }
            
            console.log('✅ SPS Application Ready');
        });
        
        // ==================== SUPABASE FUNCTIONS ====================
        
        // بررسی اتصال به Supabase
        async function checkSupabaseConnection() {
            try {
                const { data, error } = await supabase.from('users').select('count').limit(1);
                if (error) {
                    console.error('❌ خطا در اتصال به Supabase:', error);
                    return false;
                }
                console.log('✅ Connected to Supabase successfully');
                return true;
            } catch (err) {
                console.error('❌ خطا در اتصال به Supabase:', err);
                return false;
            }
        }
        
        // ==================== AUTHENTICATION FUNCTIONS ====================
        
        // ثبت‌نام کاربر جدید
        async function registerUser(fullName, email, phone, password) {
            try {
                showNotification('در حال ثبت‌نام...', 'info');
                
                // 1. ثبت‌نام در Auth
                const { data: authData, error: authError } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: fullName,
                            phone: phone
                        }
                    }
                });

                if (authError) {
                    throw new Error(authError.message);
                }

                if (authData.user) {
                    // 2. ذخیره در جدول users
                    const { error: userError } = await supabase
                        .from('users')
                        .upsert([
                            {
                                id: authData.user.id,
                                email: email,
                                phone: phone,
                                full_name: fullName,
                                subscription_type: 'none'
                            }
                        ], {
                            onConflict: 'id'
                        });

                    if (userError) {
                        console.warn('⚠️ Could not save to users table:', userError.message);
                    }
                    
                    showNotification('ثبت‌نام موفقیت‌آمیز بود!', 'success');
                    
                    closeAuthModal();

                    // 2. آپدیت متن دکمه
                    const loginBtn = document.getElementById('loginBtn');
                    loginBtn.innerHTML = '<i class="fas fa-user"></i> پروفایل';

                    // 3. رفتن مستقیم به پروفایل (بدون کلیک کاربر)
                    setTimeout(() => {
                        switchToProfileTab();
                    }, 300);

                    return { success: true, user: authData.user };
                    
                    // 3. به‌روزرسانی UI
                    setTimeout(async () => {
                        await updateProfileUI(authData.user);
                    }, 1000);
                    
                    return { success: true, user: authData.user };
                }
                
                return { success: false, error: 'خطا در ثبت‌نام' };
                
            } catch (error) {
                console.error('❌ Error in registerUser:', error);
                const errorMessage = error.message.includes('already registered') 
                    ? 'این ایمیل قبلاً ثبت‌نام کرده است' 
                    : error.message;
                showNotification(errorMessage, 'error');
                return { success: false, error: errorMessage };
            }
        }
        
        // ورود کاربر
        async function loginUser(identifier, password) {
            try {
                showNotification('در حال ورود...', 'info');
                
                let email = identifier;
                
                // اگر شماره موبایل وارد شده بود
                if (!identifier.includes('@')) {
                    const { data: userData, error: findError } = await supabase
                        .from('users')
                        .select('email')
                        .eq('phone', identifier)
                        .single();
                        
                    if (findError || !userData) {
                        throw new Error('کاربری با این اطلاعات یافت نشد');
                    }
                    
                    email = userData.email;
                }
                
                // ورود به سیستم
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) {
                    if (error.message.includes('Invalid login credentials')) {
                        throw new Error('ایمیل یا رمز عبور اشتباه است');
                    }
                    throw error;
                }
                
                showNotification('ورود موفقیت‌آمیز!', 'success');
                
                closeAuthModal();

                // 2. آپدیت متن دکمه
                const loginBtn = document.getElementById('loginBtn');
                loginBtn.innerHTML = '<i class="fas fa-user"></i> پروفایل';

                // 3. رفتن مستقیم به پروفایل (بدون کلیک کاربر)
                setTimeout(() => {
                    switchToProfileTab();
                }, 300);

                return { success: true, user: data.user };
                
                // به‌روزرسانی UI
                setTimeout(async () => {
                    await updateProfileUI(data.user);
                }, 500);
                
                return { success: true, user: data.user };
                
            } catch (error) {
                console.error('❌ خطا در ورود:', error);
                showNotification(error.message || 'خطا در ورود', 'error');
                return { success: false, error: error.message };
            }
        }
        
        // خروج کاربر
        async function logoutUser() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                
                showNotification('با موفقیت خارج شدید', 'success');
                
                // به‌روزرسانی UI
                await updateProfileUI(null);
                
                return true;
            } catch (error) {
                console.error('❌ خطا در خروج:', error);
                showNotification('خطا در خروج', 'error');
                return false;
            }
        }
        
        // بررسی وضعیت احراز هویت
        async function checkAuthStatus() {
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    console.error('Error getting session:', error);
                    await updateProfileUI(null);
                    return { isLoggedIn: false, user: null };
                }
                
                if (session) {
                    console.log('User is logged in:', session.user.email);
                    await updateProfileUI(session.user);
                    return { isLoggedIn: true, user: session.user };
                } else {
                    console.log('No active session');
                    await updateProfileUI(null);
                    return { isLoggedIn: false, user: null };
                }
            } catch (error) {
                console.error('❌ خطا در بررسی وضعیت:', error);
                await updateProfileUI(null);
                return { isLoggedIn: false, user: null };
            }
        }
        
        // دریافت اطلاعات پروفایل کاربر
        async function getUserProfile(userId) {
            try {
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('id', userId)
                    .single();
                
                if (error) {
                    // اگر کاربر در جدول users نبود، از auth data استفاده کن
                    const { data: userData } = await supabase.auth.getUser();
                    if (userData.user) {
                        return {
                            id: userData.user.id,
                            email: userData.user.email,
                            full_name: userData.user.user_metadata?.full_name || 'کاربر',
                            phone: userData.user.user_metadata?.phone || 'ندارد',
                            subscription_type: 'none',
                            created_at: new Date().toISOString()
                        };
                    }
                    throw error;
                }
                
                return data;
            } catch (error) {
                console.error('❌ خطا در دریافت پروفایل:', error);
                return null;
            }
        }
        
        // ==================== SUBSCRIPTION FUNCTIONS ====================
        
        // ایجاد اشتراک جدید
        async function createSubscription(userId, planType, price) {
            try {
                const startDate = new Date();
                const endDate = new Date();
                endDate.setFullYear(endDate.getFullYear() + 1);
                
                const { data, error } = await supabase
                    .from('subscriptions')
                    .insert([
                        {
                            user_id: userId,
                            plan_type: planType,
                            price: price,
                            status: 'pending',
                            start_date: startDate.toISOString(),
                            end_date: endDate.toISOString()
                        }
                    ])
                    .select()
                    .single();

                if (error) throw error;
                
                return { success: true, subscription: data };
                
            } catch (error) {
                console.error('❌ خطا در ایجاد اشتراک:', error);
                showNotification('خطا در ایجاد اشتراک', 'error');
                return { success: false, error: error.message };
            }
        }
        
        // فعال‌سازی اشتراک
        async function activateSubscription(subscriptionId, transactionId) {
            try {
                const { data, error } = await supabase
                    .from('subscriptions')
                    .update({
                        status: 'active',
                        transaction_id: transactionId,
                        start_date: new Date().toISOString()
                    })
                    .eq('id', subscriptionId)
                    .select()
                    .single();

                if (error) throw error;
                
                // آپدیت وضعیت کاربر
                await supabase
                    .from('users')
                    .update({
                        subscription_type: data.plan_type,
                        subscription_expiry: data.end_date
                    })
                    .eq('id', data.user_id);
                
                // به‌روزرسانی UI
                const { data: sessionData } = await supabase.auth.getSession();
                if (sessionData?.session?.user) {
                    await updateProfileUI(sessionData.session.user);
                }
                
                return { success: true };
                
            } catch (error) {
                console.error('❌ خطا در فعال‌سازی اشتراک:', error);
                return { success: false, error: error.message };
            }
        }
        
        // بررسی اشتراک کاربر
        async function checkUserSubscription(userId) {
            try {
                const { data, error } = await supabase
                    .from('subscriptions')
                    .select('*')
                    .eq('user_id', userId)
                    .eq('status', 'active')
                    .order('created_at', { ascending: false })
                    .limit(1)
                    .single();

                if (error) {
                    return null;
                }
                
                return data;
            } catch (error) {
                return null;
            }
        }
        
        // ==================== UI FUNCTIONS ====================
        
        // ==================== UPDATE PROFILE UI FOR NEW DESIGN ====================

async function updateModernProfileUI(user) {
    const userNameElement = document.getElementById('modernProfileName');
    const userEmailElement = document.getElementById('modernEmail');
    const userPhoneElement = document.getElementById('modernPhone');
    const userCreatedAtElement = document.getElementById('modernCreatedAt');
    const subscriptionTypeElement = document.getElementById('modernSubscriptionType');
    const subscriptionBadgeElement = document.getElementById('subscriptionBadge');
    const logoutSectionElement = document.getElementById('logoutSection');
    const userStatusTextElement = document.getElementById('userStatusText');
    const userAvatarElement = document.getElementById('userAvatar');
    
    if (user) {
        // دریافت اطلاعات کامل کاربر از Supabase
        const profile = await getUserProfile(user.id);
        
        if (profile) {
            // آپدیت اطلاعات اصلی
            const displayName = profile.full_name || user.email?.split('@')[0] || 'کاربر';
            userNameElement.textContent = displayName;
            document.getElementById('modernUsername').textContent = displayName;
            
            // آپدیت هدر سایت (بدون نیاز به کلیک)
            const headerNameDisplay = document.getElementById('userNameDisplay');
            if (headerNameDisplay) {
                headerNameDisplay.textContent = displayName;
                headerNameDisplay.style.display = 'block';
            }
            
            const userIcon = document.getElementById('userIcon');
            if (userIcon) {
                userIcon.innerHTML = '<i class="fas fa-user-check"></i>';
                userIcon.classList.add('logged-in');
            }
            
            userEmailElement.textContent = profile.email || user.email || 'ثبت‌نام نکرده‌اید';
            userPhoneElement.textContent = profile.phone || 'ندارد';
            
            // آپدیت تاریخ ثبت‌نام
            if (profile.created_at) {
                const date = new Date(profile.created_at);
                userCreatedAtElement.textContent = date.toLocaleDateString('fa-IR');
            } else {
                userCreatedAtElement.textContent = new Date().toLocaleDateString('fa-IR');
            }
            
            // آپدیت وضعیت اشتراک
            const subscription = await checkUserSubscription(user.id);
            if (subscription) {
                const persianPlan = subscription.plan_type === 'gold' ? 'طلایی' : 'الماس';
                const badgeClass = subscription.plan_type === 'gold' ? 'gold' : 'diamond';
                
                subscriptionTypeElement.innerHTML = `
                    <i class="fas fa-check-circle" style="color: #51cf66"></i>
                    اشتراک ${persianPlan} فعال
                `;
                
                subscriptionBadgeElement.innerHTML = `
                    <span class="badge-text ${badgeClass}">${persianPlan}</span>
                `;
                
                // آواتار ویژه برای کاربران اشتراک‌دار
                userAvatarElement.innerHTML = subscription.plan_type === 'gold' 
                    ? '<i class="fas fa-crown"></i>'
                    : '<i class="fas fa-gem"></i>';
                    
                userStatusTextElement.textContent = 'ویژه';
                userStatusTextElement.style.color = subscription.plan_type === 'gold' ? '#FFD700' : '#00FFFF';
            } else {
                subscriptionTypeElement.innerHTML = `
                    <i class="fas fa-times-circle" style="color: #ff6b6b"></i>
                    هیچ اشتراکی فعال نیست
                `;
                subscriptionBadgeElement.innerHTML = `
                    <span class="badge-text">بدون اشتراک</span>
                `;
                userStatusTextElement.textContent = 'آنلاین';
                userStatusTextElement.style.color = '#51cf66';
                userAvatarElement.innerHTML = '<i class="fas fa-user"></i>';
            }
            
            // نمایش دکمه خروج
            logoutSectionElement.style.display = 'block';
            
        } else {
            // اگر پروفایل کامل پیدا نشد، از اطلاعات auth استفاده کن
            const displayName = user.user_metadata?.full_name || user.email?.split('@')[0] || 'کاربر';
            userNameElement.textContent = displayName;
            document.getElementById('modernUsername').textContent = displayName;
            
            // آپدیت هدر سایت
            const headerNameDisplay = document.getElementById('userNameDisplay');
            if (headerNameDisplay) {
                headerNameDisplay.textContent = displayName;
                headerNameDisplay.style.display = 'block';
            }
            
            const userIcon = document.getElementById('userIcon');
            if (userIcon) {
                userIcon.innerHTML = '<i class="fas fa-user-check"></i>';
                userIcon.classList.add('logged-in');
            }
            
            userEmailElement.textContent = user.email || 'ثبت‌نام نکرده‌اید';
            userPhoneElement.textContent = user.user_metadata?.phone || 'ندارد';
            userCreatedAtElement.textContent = new Date().toLocaleDateString('fa-IR');
            logoutSectionElement.style.display = 'block';
            userAvatarElement.innerHTML = '<i class="fas fa-user"></i>';
        }
        
    } else {
        // حالت مهمان
        userNameElement.textContent = 'کاربر مهمان';
        document.getElementById('modernUsername').textContent = 'کاربر مهمان';
        userEmailElement.textContent = 'ثبت‌نام نکرده‌اید';
        userPhoneElement.textContent = 'ندارد';
        userCreatedAtElement.textContent = '-';
        subscriptionTypeElement.innerHTML = `
            <i class="fas fa-times-circle" style="color: #ff6b6b"></i>
            هیچ اشتراکی فعال نیست
        `;
        subscriptionBadgeElement.innerHTML = `
            <span class="badge-text">بدون اشتراک</span>
        `;
        userStatusTextElement.textContent = 'آنلاین';
        userStatusTextElement.style.color = '#51cf66';
        logoutSectionElement.style.display = 'none';
        
        // آواتار پیش‌فرض
        userAvatarElement.innerHTML = '<i class="fas fa-user"></i>';
        
        // آپدیت هدر سایت
        const headerNameDisplay = document.getElementById('userNameDisplay');
        if (headerNameDisplay) {
            headerNameDisplay.style.display = 'none';
        }
        
        const userIcon = document.getElementById('userIcon');
        if (userIcon) {
            userIcon.innerHTML = '<i class="fas fa-user"></i>';
            userIcon.classList.remove('logged-in');
        }
    }
}

// ==================== SETUP NEW PROFILE EVENTS ====================

function setupModernProfileEvents() {
    const modernLogoutBtn = document.getElementById('modernLogoutBtn');
    
    if (modernLogoutBtn) {
        // حذف event listener های قبلی
        modernLogoutBtn.replaceWith(modernLogoutBtn.cloneNode(true));
        const newLogoutBtn = document.getElementById('modernLogoutBtn');
        
        newLogoutBtn.addEventListener('click', async function(e) {
            e.preventDefault();
            
            // جلوگیری از کلیک‌های متعدد
            if (this.classList.contains('processing')) return;
            this.classList.add('processing');
            
            try {
                // نمایش نوتیفیکیشن در حال خروج
                showNotification('در حال خروج از حساب...', 'info');
                
                // کمی تأخیر برای نمایش نوتیفیکیشن
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // خروج از حساب
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                
                // آپدیت سریع UI
                await updateModernProfileUI(null);
                
                // بروزرسانی دکمه اصلی سایت
                const loginBtn = document.getElementById('loginBtn');
                if (loginBtn) {
                    loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> پروفایل کاربری';
                }
                
                // رفتن به صفحه اصلی بعد از تأخیر
                setTimeout(() => {
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    document.querySelector('[data-tab="home"]').classList.add('active');
                    document.getElementById('homeTab').classList.add('active');
                    
                    // اسکرول به بالا
                    document.querySelector('.main-container').scrollTop = 0;
                    
                    // نوتیفیکیشن موفقیت
                    setTimeout(() => {
                        showNotification('با موفقیت از حساب خارج شدید', 'success');
                    }, 300);
                }, 500);
                
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('خطا در خروج از حساب', 'error');
                this.classList.remove('processing');
            }
        });
    }
}

// ==================== MODIFY EXISTING FUNCTIONS ====================

// تابع اصلی updateProfileUI را بروزرسانی کنید
async function updateProfileUI(user) {
    // همزمان هر دو UI را آپدیت کن
    try {
        await updateModernProfileUI(user);
    } catch (error) {
        console.error('Error updating modern profile UI:', error);
    }
    
    // آپدیت هدر و دکمه‌های اصلی
    const userNameDisplay = document.getElementById('userNameDisplay');
    const userIcon = document.getElementById('userIcon');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginBtn = document.getElementById('loginBtn');
    
    if (user) {
        if (userNameDisplay) {
            const displayName = user.user_metadata?.full_name || user.email?.split('@')[0] || 'کاربر';
            userNameDisplay.textContent = displayName;
            userNameDisplay.style.display = 'block';
        }
        
        if (userIcon) {
            userIcon.innerHTML = '<i class="fas fa-user-check"></i>';
            userIcon.classList.add('logged-in');
        }
        
        if (logoutBtn) logoutBtn.style.display = 'block';
        if (loginBtn) {
            loginBtn.innerHTML = '<i class="fas fa-user"></i> پروفایل';
            loginBtn.style.display = 'inline-flex';
        }
    } else {
        if (userNameDisplay) {
            userNameDisplay.style.display = 'none';
        }
        
        if (userIcon) {
            userIcon.innerHTML = '<i class="fas fa-user"></i>';
            userIcon.classList.remove('logged-in');
        }
        
        if (logoutBtn) logoutBtn.style.display = 'none';
        if (loginBtn) {
            loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> پروفایل کاربری';
            loginBtn.style.display = 'inline-flex';
        }
    }
}

// ==================== تابع خروج کاربر (تصحیح شده) ====================

async function logoutUser() {
    try {
        const { error } = await supabase.auth.signOut();
        if (error) throw error;
        
        showNotification('با موفقیت خارج شدید', 'success');
        
        // به‌روزرسانی UI
        await updateProfileUI(null);
        
        return true;
    } catch (error) {
        console.error('❌ خطا در خروج:', error);
        showNotification('خطا در خروج', 'error');
        return false;
    }
}

// ==================== INITIALIZE MODERN PROFILE ====================

document.addEventListener('DOMContentLoaded', function() {
    // راه‌اندازی رویدادهای پروفایل جدید
    setTimeout(() => {
        setupModernProfileEvents();
        
        // بررسی اولیه وضعیت کاربر
        supabase.auth.getSession().then(async ({ data: sessionData }) => {
            if (sessionData?.session?.user) {
                console.log('User logged in on load:', sessionData.session.user.email);
                await updateModernProfileUI(sessionData.session.user);
            } else {
                console.log('No user on load');
                await updateModernProfileUI(null);
            }
        });
        
        // گوش دادن به تغییرات auth state
        supabase.auth.onAuthStateChange(async (event, session) => {
            console.log('Auth state changed:', event, session?.user?.email);
            await updateModernProfileUI(session?.user || null);
        });
    }, 1000);
});
        
        // تغییر به تب پروفایل
        function switchToProfileTab() {
            // غیرفعال کردن همه تب‌ها
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // فعال کردن تب پروفایل
            document.querySelector('[data-tab="profile"]').classList.add('active');
            document.getElementById('profileTab').classList.add('active');
            
            // اسکرول به بالا
            document.querySelector('.main-container').scrollTop = 0;
            
            // به‌روزرسانی اطلاعات پروفایل
            supabase.auth.getSession().then(({ data: sessionData }) => {
                if (sessionData?.session?.user) {
                    updateProfileUI(sessionData.session.user);
                }
            });
        }
        
        // نمایش نوتیفیکیشن
        function showNotification(message, type = 'info') {
            // حذف نوتیفیکیشن‌های قبلی
            const oldNotifications = document.querySelectorAll('.notification');
            oldNotifications.forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            if (type === 'error') icon = 'fa-exclamation-circle';
            
            notification.innerHTML = `
                <i class="fas ${icon}" style="color: ${type === 'success' ? '#51cf66' : type === 'error' ? '#ff6b6b' : '#FFD700'}; font-size: 16px;"></i>
                <div style="font-size: 14px;">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideIn 0.3s ease reverse';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }
        
        // ==================== فرم چند مرحله‌ای جدید ====================
        
        // مدیریت فرم چند مرحله‌ای
        let currentStep = 1;
        let formData = {
            fullName: '',
            phone: '',
            email: '',
            password: ''
        };
        
        // رفتن به مرحله بعد
        function goToNextStep() {
            if (currentStep === 1) {
                // اعتبارسنجی مرحله ۱
                const fullName = document.getElementById('fullName').value.trim();
                const phone = document.getElementById('phone').value.trim();
                
                let isValid = true;
                clearFormErrors();
                
                if (!fullName || fullName.length < 2) {
                    showError('fullNameError', 'نام کامل الزامی است (حداقل ۲ حرف)');
                    isValid = false;
                }
                
                if (!phone || !/^09\d{9}$/.test(phone)) {
                    showError('phoneError', 'شماره موبایل معتبر وارد کنید (با ۰۹ شروع شده و ۱۱ رقم باشد)');
                    isValid = false;
                }
                
                if (!isValid) return;
                
                // ذخیره داده‌ها
                formData.fullName = fullName;
                formData.phone = phone;
                
                // رفتن به مرحله ۲
                document.getElementById('registerStep1').classList.remove('active');
                document.getElementById('registerStep2').classList.add('active');
                document.querySelector('.step-1').classList.remove('active');
                document.querySelector('.step-1').classList.add('completed');
                document.querySelector('.step-2').classList.add('active');
                currentStep = 2;
                
                // نمایش داده‌های مرحله ۱ در موفقیت
                showSuccess('phoneSuccess', `شماره ${phone} ثبت شد`);
                
                // افکت ویبره
                if (navigator.vibrate) navigator.vibrate(30);
            }
        }
        
        // برگشت به مرحله قبل
        function goToPrevStep() {
            if (currentStep === 2) {
                document.getElementById('registerStep2').classList.remove('active');
                document.getElementById('registerStep1').classList.add('active');
                document.querySelector('.step-2').classList.remove('active');
                document.querySelector('.step-1').classList.add('active');
                document.querySelector('.step-1').classList.remove('completed');
                currentStep = 1;
                
                // افکت ویبره
                if (navigator.vibrate) navigator.vibrate(30);
            }
        }
        
        // ثبت‌نام نهایی
        async function submitRegistration() {
            clearFormErrors();
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            let isValid = true;
            
            // اعتبارسنجی ایمیل
            if (!email || !email.includes('@') || !email.includes('.')) {
                showError('emailError', 'ایمیل معتبر وارد کنید');
                isValid = false;
            }
            
            // اعتبارسنجی رمز عبور
            if (!password || password.length < 6) {
                showError('passwordError', 'رمز عبور باید حداقل ۶ کاراکتر باشد');
                isValid = false;
            }
            
            // اعتبارسنجی تکرار رمز عبور
            if (password !== confirmPassword) {
                showError('confirmPasswordError', 'رمز عبور با تکرار آن مطابقت ندارد');
                isValid = false;
            }
            
            if (!isValid) return;
            
            // ذخیره داده‌ها
            formData.email = email;
            formData.password = password;
            
            // غیرفعال کردن دکمه ثبت‌نام
            const submitBtn = document.getElementById('registerSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<div class="loading"></div> در حال ثبت‌نام...';
            
            // ثبت‌نام
            const result = await registerUser(
                formData.fullName,
                formData.email,
                formData.phone,
                formData.password
            );
            
            // فعال‌سازی مجدد دکمه
            submitBtn.disabled = false;
            submitBtn.classList.remove('loading');
            submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> ایجاد حساب';
        }
        
        // ==================== فرم ورود ====================
        
        async function submitLogin() {
            clearFormErrors();
            
            const identifier = document.getElementById('loginIdentifier').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!identifier) {
                showError('loginIdentifierError', 'ایمیل یا شماره موبایل الزامی است');
                return;
            }
            
            if (!password) {
                showError('loginPasswordError', 'رمز عبور الزامی است');
                return;
            }
            
            // غیرفعال کردن دکمه ورود
            const loginSubmitBtn = document.getElementById('loginSubmitBtn');
            loginSubmitBtn.disabled = true;
            loginSubmitBtn.classList.add('loading');
            loginSubmitBtn.innerHTML = '<div class="loading"></div> در حال ورود...';
            
            // ورود
            const result = await loginUser(identifier, password);
            
            // فعال‌سازی مجدد دکمه
            loginSubmitBtn.disabled = false;
            loginSubmitBtn.classList.remove('loading');
            loginSubmitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ورود به حساب';
        }
        
        // نمایش خطای فرم
        function showError(fieldId, message) {
            const errorEl = document.getElementById(fieldId);
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.style.display = 'block';
            }
        }
        
        // نمایش موفقیت
        function showSuccess(fieldId, message) {
            const successEl = document.getElementById(fieldId);
            if (successEl) {
                successEl.textContent = message;
                successEl.style.display = 'block';
                setTimeout(() => {
                    successEl.style.display = 'none';
                }, 3000);
            }
        }
        
        // پاک کردن خطاهای فرم
        function clearFormErrors() {
            document.querySelectorAll('.error-message, .success-message').forEach(el => {
                el.style.display = 'none';
                el.textContent = '';
            });
        }
        
        // نمایش/پنهان کردن رمز عبور
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const toggleBtn = field.parentNode.querySelector('.toggle-password i');
            
            if (field.type === 'password') {
                field.type = 'text';
                toggleBtn.classList.remove('fa-eye');
                toggleBtn.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                toggleBtn.classList.remove('fa-eye-slash');
                toggleBtn.classList.add('fa-eye');
            }
            
            // افکت ویبره
            if (navigator.vibrate) navigator.vibrate(30);
        }
        
        // ==================== MODAL FUNCTIONS ====================
        
        // نمایش مودال احراز هویت
        function showAuthModal() {
            const authModal = document.getElementById('authModal');
            authModal.style.display = 'flex';
            
            // ریست فرم‌ها
            resetForms();
            
            // نمایش فرم ثبت‌نام به صورت پیش‌فرض
            showRegisterForm();
        }
        
        // نمایش فرم ثبت‌نام
        function showRegisterForm() {
            document.getElementById('registerWizard').style.display = 'block';
            document.getElementById('loginFormContainer').style.display = 'none';
            document.getElementById('registerSwitch').style.display = 'block';
            
            // ریست مراحل
            currentStep = 1;
            formData = { fullName: '', phone: '', email: '', password: '' };
            
            document.getElementById('registerStep1').classList.add('active');
            document.getElementById('registerStep2').classList.remove('active');
            document.querySelector('.step-1').classList.add('active');
            document.querySelector('.step-1').classList.remove('completed');
            document.querySelector('.step-2').classList.remove('active');
            
            clearFormErrors();
        }
        
        // نمایش فرم ورود
        function showLoginForm() {
            document.getElementById('registerWizard').style.display = 'none';
            document.getElementById('loginFormContainer').style.display = 'block';
            document.getElementById('registerSwitch').style.display = 'none';
            clearFormErrors();
        }
        
        // بستن مودال
        function closeAuthModal() {
            const authModal = document.getElementById('authModal');
            authModal.style.display = 'none';
            clearFormErrors();
            resetForms();
        }
        
        // ریست فرم‌ها
        function resetForms() {
            document.getElementById('fullName').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('email').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            document.getElementById('loginIdentifier').value = '';
            document.getElementById('loginPassword').value = '';
            
            // ریست مراحل
            currentStep = 1;
            formData = { fullName: '', phone: '', email: '', password: '' };
            
            document.getElementById('registerStep1').classList.add('active');
            document.getElementById('registerStep2').classList.remove('active');
            document.querySelector('.step-1').classList.add('active');
            document.querySelector('.step-1').classList.remove('completed');
            document.querySelector('.step-2').classList.remove('active');
        }
        
        // ==================== NAVIGATION FUNCTIONS ====================
        
        // تنظیم نویگیشن
        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            const tabContents = document.querySelectorAll('.tab-content');
            
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const tabId = this.getAttribute('data-tab');
                    
                    navItems.forEach(nav => nav.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                    
                    // اسکرول به بالا
                    document.querySelector('.main-container').scrollTop = 0;
                });
            });
            
            // کلیک روی آیکون کاربر در هدر
            document.getElementById('userIcon').addEventListener('click', async function() {
                try {
                    const { data: sessionData } = await supabase.auth.getSession();
                    
                    if (sessionData?.session) {
                        // کاربر وارد شده: برو به پروفایل
                        switchToProfileTab();
                    } else {
                        // کاربر وارد نشده: نمایش مودال
                        showAuthModal();
                    }
                    
                    // اسکرول به بالا
                    document.querySelector('.main-container').scrollTop = 0;
                } catch (error) {
                    console.error('Error in user icon click:', error);
                    showAuthModal();
                }
            });
        }
        
        // ==================== PURCHASE FUNCTIONS ====================
        
        // تنظیم دکمه‌های خرید
        function setupPurchaseButtons() {
            // خرید اشتراک طلایی
            document.getElementById('goldPurchaseBtn').addEventListener('click', async function(e) {
                e.stopPropagation();
                
                try {
                    const { data: session } = await supabase.auth.getSession();
                    
                    if (!session?.session) {
                        showNotification('لطفاً ابتدا وارد حساب کاربری خود شوید', 'error');
                        showAuthModal();
                        return;
                    }
                    
                    showNotification('در حال ایجاد اشتراک طلایی...', 'info');
                    
                    const result = await createSubscription(
                        session.session.user.id, 
                        'gold', 
                        1200000
                    );
                    
                    if (result.success) {
                        showNotification('اشتراک طلایی ایجاد شد! در حال انتقال به درگاه پرداخت...', 'success');
                        
                        // شبیه‌سازی پرداخت
                        setTimeout(async () => {
                            try {
                                const activation = await activateSubscription(
                                    result.subscription.id,
                                    'TXN_' + Date.now()
                                );
                                
                                if (activation.success) {
                                    showNotification('اشتراک طلایی با موفقیت فعال شد!', 'success');
                                }
                            } catch (error) {
                                console.error('Error activating subscription:', error);
                            }
                        }, 2000);
                    }
                } catch (error) {
                    console.error('Error in gold purchase:', error);
                    showNotification('خطا در خرید اشتراک', 'error');
                }
            });
            
            // خرید اشتراک الماس
            document.getElementById('diamondPurchaseBtn').addEventListener('click', async function(e) {
                e.stopPropagation();
                
                try {
                    const { data: session } = await supabase.auth.getSession();
                    
                    if (!session?.session) {
                        showNotification('لطفاً ابتدا وارد حساب کاربری خود شوید', 'error');
                        showAuthModal();
                        return;
                    }
                    
                    showNotification('در حال ایجاد اشتراک الماس...', 'info');
                    
                    const result = await createSubscription(
                        session.session.user.id, 
                        'diamond', 
                        1920000
                    );
                    
                    if (result.success) {
                        showNotification('اشتراک الماس ایجاد شد! در حال انتقال به درگاه پرداخت...', 'success');
                        
                        // شبیه‌سازی پرداخت
                        setTimeout(async () => {
                            try {
                                const activation = await activateSubscription(
                                    result.subscription.id,
                                    'TXN_' + Date.now()
                                );
                                
                                if (activation.success) {
                                    showNotification('اشتراک الماس با موفقیت فعال شد!', 'success');
                                }
                            } catch (error) {
                                console.error('Error activating subscription:', error);
                            }
                        }, 2000);
                    }
                } catch (error) {
                    console.error('Error in diamond purchase:', error);
                    showNotification('خطا در خرید اشتراک', 'error');
                }
            });
        }
        
        // ==================== UTILITY FUNCTIONS ====================
        
        // ایجاد ذرات انرژی
        function createEnergyParticles() {
            const lampContainer = document.querySelector('.lamp-container');
            if (!lampContainer) return;
            
            const particleCount = 15;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'energy-particle';
                
                const colors = ['#FFD700', '#00FFFF', '#FF66B2'];
                particle.style.background = colors[i % 3];
                
                const angle = Math.random() * Math.PI * 2;
                const distance = 60 + Math.random() * 90;
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                
                particle.style.left = `calc(50% + ${x}px)`;
                particle.style.top = `calc(50% + ${y}px)`;
                
                const tx = (Math.random() - 0.5) * 120;
                const ty = (Math.random() - 0.5) * 120;
                
                particle.style.setProperty('--tx', `${tx}px`);
                particle.style.setProperty('--ty', `${ty}px`);
                
                particle.style.animationDelay = `${Math.random() * 2}s`;
                
                lampContainer.appendChild(particle);
            }
        }
        
        // تنظیم دکمه بازگشت به بالا
        function setupBackToTop() {
            const backToTopBtn = document.getElementById('backToTop');
            const mainContainer = document.querySelector('.main-container');
            
            backToTopBtn.addEventListener('click', () => {
                mainContainer.scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            mainContainer.addEventListener('scroll', () => {
                if (mainContainer.scrollTop > 300) {
                    backToTopBtn.style.display = 'flex';
                } else {
                    backToTopBtn.style.display = 'none';
                }
            });
        }
        
        // ایجاد افکت ripple
        function createRipple(event) {
            const button = event.currentTarget;
            const circle = document.createElement("span");
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;

            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${event.clientX - button.getBoundingClientRect().left - radius}px`;
            circle.style.top = `${event.clientY - button.getBoundingClientRect().top - radius}px`;
            circle.classList.add("ripple");

            const ripple = button.getElementsByClassName("ripple")[0];
            if (ripple) {
                ripple.remove();
            }

            button.appendChild(circle);
        }
        
        // تنظیم دکمه مرکزی نویگیشن
        function setupCenterButton() {
            const centerButton = document.getElementById('centerNavButton');
            if (!centerButton) return;
            
            centerButton.addEventListener('click', function(e) {
                // رفتن به صفحه اصلی
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                document.querySelector('[data-tab="home"]').classList.add('active');
                document.getElementById('homeTab').classList.add('active');
                
                // فعال کردن دکمه مرکزی
                this.classList.add('active');
                setTimeout(() => {
                    this.classList.remove('active');
                }, 1000);
                
                // اسکرول به بالا
                document.querySelector('.main-container').scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                
                
                // افکت ripple
                createRipple(e);
            });
        }
        
        // ==================== EVENT LISTENERS SETUP ====================

        function setupEventListeners() {
            // تنظیم نویگیشن
            setupNavigation();
            
            // تنظیم دکمه‌های خرید
            setupPurchaseButtons();
            
            // تنظیم دکمه مرکزی نویگیشن
            setupCenterButton();
            
            // دکمه‌های مودال
            const closeModalBtn = document.getElementById('closeModal');
            const loginBtn = document.getElementById('loginBtn');
            const authModal = document.getElementById('authModal');
            const logoutBtn = document.getElementById('logoutBtn');
            
            // دکمه ورود/پروفایل در صفحه اصلی
            loginBtn.addEventListener('click', async function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                try {
                    // بررسی وضعیت فعلی با یک درخواست fresh
                    const { data: { session }, error } = await supabase.auth.getSession();
                    
                    if (error) {
                        console.error('Error getting session:', error);
                        showAuthModal();
                        return;
                    }
                    
                    console.log('Current session status:', !!session);
                    
                    if (session) {
                        // کاربر وارد شده: برو به پروفایل
                        console.log('User is logged in, redirecting to profile');
                        switchToProfileTab();
                        
                        // فورس آپدیت UI
                        await updateProfileUI(session.user);
                    } else {
                        // کاربر وارد نشده: نمایش مودال
                        console.log('User is not logged in, showing auth modal');
                        showAuthModal();
                    }
                } catch (error) {
                    console.error('Error checking session:', error);
                    showAuthModal();
                }
                
                // افکت ripple
                createRipple(e);
            });
            
            // اضافه کردن افکت ripple به دکمه‌های نویگیشن
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', createRipple);
            });
            
            // بستن مودال
            closeModalBtn.addEventListener('click', closeAuthModal);
            
            // بستن مودال با کلیک خارج
            authModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAuthModal();
                }
            });
            
            // بستن مودال با دکمه ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeAuthModal();
                }
            });
            
            // سوئیچ بین ثبت‌نام و ورود
            document.getElementById('switchToLogin').addEventListener('click', function() {
                showLoginForm();
                
                // افکت ویبره
                if (navigator.vibrate) navigator.vibrate(30);
            });
            
            document.getElementById('switchToRegister').addEventListener('click', function() {
                showRegisterForm();
                
                // افکت ویبره
                if (navigator.vibrate) navigator.vibrate(30);
            });
            
            // دکمه‌های فرم چند مرحله‌ای
            document.getElementById('nextStep1').addEventListener('click', goToNextStep);
            document.getElementById('prevStep2').addEventListener('click', goToPrevStep);
            
            // ثبت‌نام نهایی
            document.getElementById('registerStep2').addEventListener('submit', function(e) {
                e.preventDefault();
                submitRegistration();
            });
            
            // ورود
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitLogin();
            });
            
            // دکمه خروج
            logoutBtn.addEventListener('click', async function() {
                if (confirm('آیا مطمئن هستید که می‌خواهید خارج شوید؟')) {
                    try {
                        const success = await logoutUser();
                        if (success) {
                            // رفتن به صفحه اصلی
                            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                            
                            document.querySelector('[data-tab="home"]').classList.add('active');
                            document.getElementById('homeTab').classList.add('active');
                            
                            // ریست دکمه مرکزی
                            const centerButton = document.getElementById('centerNavButton');
                            if (centerButton) {
                                centerButton.classList.remove('active');
                            }
                            
                            // نوتیفیکیشن
                            showNotification('با موفقیت از حساب خارج شدید', 'success');
                            
                            // افکت ویبره
                            if (navigator.vibrate) navigator.vibrate(100);
                        }
                    } catch (error) {
                        console.error('Error in logout:', error);
                    }
                }
            });
            
            // مدیریت رمز عبور
            document.querySelectorAll('.toggle-password').forEach(btn => {
                btn.addEventListener('click', function() {
                    const fieldId = this.parentNode.querySelector('input').id;
                    togglePassword(fieldId);
                });
            });
            
            // دکمه‌های خرید - اضافه کردن افکت ripple
            document.querySelectorAll('.btn-purchase').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    createRipple(e);
                    
                    // افکت ویبره
                    if (navigator.vibrate) navigator.vibrate(80);
                });
            });
            
            // دکمه‌های اصلی - اضافه کردن افکت ripple
            document.querySelectorAll('.btn-primary, .btn-secondary').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    createRipple(e);
                    
                    // افکت ویبره
                    if (navigator.vibrate) navigator.vibrate(60);
                });
            });
            
            // افزودن event برای دکمه بازگشت به بالا
            document.getElementById('backToTop').addEventListener('click', function(e) {
                createRipple(e);
                
                // افکت ویبره
                if (navigator.vibrate) navigator.vibrate(40);
            });
            
            // نمایش اسپلش انیمیشن هنگام بارگذاری
            window.addEventListener('load', function() {
                setTimeout(() => {
                    const lamp = document.querySelector('.lamp-icon');
                    if (lamp) {
                        lamp.style.animation = 'lampGlow 3s infinite alternate ease-in-out';
                    }
                }, 500);
            });
            
            // جلوگیری از اسکرول هنگام باز بودن مودال
            authModal.addEventListener('wheel', function(e) {
                e.stopPropagation();
            }, { passive: false });
            
            // اعتبارسنجی شماره موبایل هنگام تایپ
            document.getElementById('phone').addEventListener('input', function(e) {
                const value = e.target.value.replace(/[^0-9]/g, '');
                e.target.value = value;
                
                if (value.startsWith('9')) {
                    e.target.value = '0' + value;
                }
            });
            
            // کلید Enter در فرم‌ها
            document.getElementById('fullName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('nextStep1').click();
                }
            });
            
            document.getElementById('phone').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('nextStep1').click();
                }
            });
            
            document.getElementById('loginIdentifier').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('loginPassword').focus();
                }
            });
            
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('loginSubmitBtn').click();
                }
            });
        }
    </script>
    <!-- لودینگ مدرن برقی SPS -->
<script>
// ==================== لودینگ برقی SPS ====================
(function() {
    'use strict';
    
    // ایجاد استایل‌های لودینگ
    const loaderStyles = `
    <style id="sps-electric-loader-styles">
        /* ========== لودینگ مدرن برقی ========== */
        .sps-electric-loader {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(10, 15, 43, 0.9) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(26, 31, 60, 0.9) 0%, transparent 50%),
                linear-gradient(135deg, #0A0F2B 0%, #1A1F3C 100%);
            z-index: 999999;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: 'Inter', 'Vazirmatn', sans-serif;
        }
        
        /* کانتینر اصلی */
        .sps-electric-container {
            position: relative;
            width: 100%;
            max-width: 480px;
            padding: 40px;
            text-align: center;
            z-index: 10;
        }
        
        /* مدار برقی مرکزی */
        .sps-electric-core {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 0 auto 40px;
        }
        
        .sps-circuit {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid transparent;
            animation: circuitPulse 4s infinite ease-in-out;
        }
        
        .sps-circuit-1 {
            border-top: 2px solid #FFD700;
            border-right: 2px solid #FFD700;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
            animation-delay: 0s;
        }
        
        .sps-circuit-2 {
            width: 85%;
            height: 85%;
            top: 7.5%;
            right: 7.5%;
            border-bottom: 2px solid #00FFFF;
            border-left: 2px solid #00FFFF;
            filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.5));
            animation-delay: 0.5s;
        }
        
        .sps-circuit-3 {
            width: 70%;
            height: 70%;
            top: 15%;
            right: 15%;
            border-top: 2px solid #FF66B2;
            border-right: 2px solid #FF66B2;
            filter: drop-shadow(0 0 10px rgba(255, 102, 178, 0.5));
            animation-delay: 1s;
        }
        
        /* مرکز انرژی */
        .sps-energy-center {
            position: absolute;
            top: 50%;
            right: 50%;
            transform: translate(50%, -50%);
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, 
                #FFD700 0%,
                #FFAA00 50%,
                transparent 70%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #0A0F2B;
            filter: 
                drop-shadow(0 0 20px #FFD700)
                drop-shadow(0 0 40px rgba(255, 215, 0, 0.5));
            animation: energyPulse 2s infinite alternate;
        }
        
        /* جرقه‌های برقی */
        .sps-electric-spark {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #FFD700;
            border-radius: 50%;
            filter: blur(1px);
            animation: sparkFlash 1.5s infinite linear;
        }
        
        /* موج انرژی */
        .sps-energy-wave {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 1px solid transparent;
            animation: waveExpand 3s infinite linear;
        }
        
        /* متن لوگو */
        .sps-electric-logo {
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
        }
        
        .sps-electric-title {
            font-family: 'Playfair Display', serif;
            font-size: 52px;
            font-weight: 900;
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
        }
        
        .sps-electric-text {
            background: linear-gradient(90deg, 
                #FFD700 0%, 
                #00FFFF 50%, 
                #FF66B2 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: electricFlow 3s infinite linear;
        }
        
        .sps-electric-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            letter-spacing: 3px;
            font-weight: 300;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        /* آیکون‌های برقی */
        .sps-electric-icons {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 35px 0;
            flex-wrap: wrap;
        }
        
        .sps-electric-icon {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .sps-electric-icon.active {
            background: rgba(255, 215, 0, 0.1);
            color: #FFD700;
            border-color: rgba(255, 215, 0, 0.3);
            transform: translateY(-5px);
            box-shadow: 
                0 10px 20px rgba(255, 215, 0, 0.2),
                0 0 20px rgba(255, 215, 0, 0.1);
        }
        
        .sps-electric-icon::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }
        
        .sps-electric-icon.active::before {
            transform: translateX(100%);
        }
        
        /* نوسانگر انرژی */
        .sps-energy-oscillator {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin: 30px 0;
            overflow: hidden;
            position: relative;
        }
        
        .sps-oscillator-line {
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                #FFD700, 
                #00FFFF, 
                transparent);
            filter: blur(1px);
            animation: oscillatorMove 2s infinite linear;
        }
        
        /* زمان سنج */
        .sps-electric-timer {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            font-family: monospace;
            letter-spacing: 1px;
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
        }
        
        .sps-timer-dots {
            animation: timerBlink 1s infinite;
        }
        
        /* انیمیشن خروج */
        .sps-electric-loader.fade-out {
            animation: electricFadeOut 0.7s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        /* انیمیشن‌ها */
        @keyframes circuitPulse {
            0%, 100% { 
                opacity: 0.4;
                transform: scale(0.95);
            }
            50% { 
                opacity: 1;
                transform: scale(1.05);
            }
        }
        
        @keyframes energyPulse {
            0% { 
                box-shadow: 
                    0 0 20px #FFD700,
                    0 0 40px rgba(255, 215, 0, 0.5),
                    0 0 60px rgba(255, 215, 0, 0.2);
                transform: translate(50%, -50%) scale(1);
            }
            100% { 
                box-shadow: 
                    0 0 40px #FFD700,
                    0 0 80px rgba(255, 215, 0, 0.6),
                    0 0 120px rgba(255, 215, 0, 0.3);
                transform: translate(50%, -50%) scale(1.1);
            }
        }
        
        @keyframes sparkFlash {
            0%, 100% { 
                opacity: 0;
                transform: scale(0.3);
            }
            50% { 
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes waveExpand {
            0% { 
                border-color: rgba(255, 215, 0, 0.1);
                transform: scale(1);
                opacity: 1;
            }
            100% { 
                border-color: rgba(255, 215, 0, 0);
                transform: scale(1.5);
                opacity: 0;
            }
        }
        
        @keyframes electricFlow {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        
        @keyframes oscillatorMove {
            0% { right: -100%; }
            100% { right: 100%; }
        }
        
        @keyframes timerBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        @keyframes electricFadeOut {
            0% { 
                opacity: 1;
                filter: blur(0);
            }
            100% { 
                opacity: 0;
                filter: blur(10px);
                visibility: hidden;
            }
        }
        
        /* رسپانسیو */
        @media (max-width: 768px) {
            .sps-electric-container {
                padding: 30px;
                max-width: 400px;
            }
            
            .sps-electric-core {
                width: 180px;
                height: 180px;
            }
            
            .sps-electric-title {
                font-size: 44px;
            }
            
            .sps-electric-icons {
                gap: 20px;
            }
            
            .sps-electric-icon {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .sps-electric-container {
                padding: 20px;
                max-width: 320px;
            }
            
            .sps-electric-core {
                width: 150px;
                height: 150px;
                margin-bottom: 30px;
            }
            
            .sps-electric-title {
                font-size: 38px;
            }
            
            .sps-electric-subtitle {
                font-size: 12px;
                letter-spacing: 2px;
            }
            
            .sps-electric-icons {
                gap: 15px;
            }
            
            .sps-electric-icon {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
        }
    </style>
    `;
    
    // ساختار HTML لودینگ
    const loaderHTML = `
    <div class="sps-electric-loader">
        <div class="sps-electric-container">
            <!-- مدار برقی مرکزی -->
            <div class="sps-electric-core">
                <div class="sps-circuit sps-circuit-1"></div>
                <div class="sps-circuit sps-circuit-2"></div>
                <div class="sps-circuit sps-circuit-3"></div>
                
                <!-- مرکز انرژی -->
                <div class="sps-energy-center">
                    <i class="fas fa-bolt"></i>
                </div>
                
                <!-- جرقه‌های برقی -->
                <div class="sps-electric-spark" style="top: 20%; right: 50%;"></div>
                <div class="sps-electric-spark" style="top: 50%; right: 20%;"></div>
                <div class="sps-electric-spark" style="top: 80%; right: 50%;"></div>
                <div class="sps-electric-spark" style="top: 50%; right: 80%;"></div>
                
                <!-- موج انرژی -->
                <div class="sps-energy-wave"></div>
                <div class="sps-energy-wave" style="animation-delay: 1s;"></div>
                <div class="sps-energy-wave" style="animation-delay: 2s;"></div>
            </div>
            
            <!-- متن لوگو -->
            <div class="sps-electric-logo">
                <div class="sps-electric-subtitle">سیستم مدیریت انرژی</div>
                <div class="sps-electric-title">
                    <span class="sps-electric-text">SPS</span>
                </div>
                <div class="sps-electric-subtitle">Power Smart System</div>
            </div>
            
            <!-- نوسانگر انرژی -->
            <div class="sps-energy-oscillator">
                <div class="sps-oscillator-line"></div>
            </div>
            
            <!-- آیکون‌های برقی -->
            <div class="sps-electric-icons" id="electricIcons">
                <div class="sps-electric-icon" data-icon="bolt">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="sps-electric-icon" data-icon="charging-station">
                    <i class="fas fa-charging-station"></i>
                </div>
                <div class="sps-electric-icon" data-icon="solar-panel">
                    <i class="fas fa-solar-panel"></i>
                </div>
                <div class="sps-electric-icon" data-icon="microchip">
                    <i class="fas fa-microchip"></i>
                </div>
                <div class="sps-electric-icon" data-icon="satellite-dish">
                    <i class="fas fa-satellite-dish"></i>
                </div>
            </div>
            
            <!-- زمان سنج -->
            <div class="sps-electric-timer" id="electricTimer">
                <span>سیستم در حال راه‌اندازی</span>
                <span class="sps-timer-dots">...</span>
            </div>
        </div>
    </div>
    `;
    
    // اضافه کردن استایل و HTML به صفحه
    document.head.insertAdjacentHTML('beforeend', loaderStyles);
    document.body.insertAdjacentHTML('afterbegin', loaderHTML);
    
    // ایجاد انیمیشن آیکون‌ها
    function animateElectricIcons() {
        const icons = document.querySelectorAll('.sps-electric-icon');
        const totalTime = 7000; // 7 ثانیه
        const iconCount = icons.length;
        const intervalTime = totalTime / iconCount;
        
        let currentIndex = 0;
        
        const iconInterval = setInterval(() => {
            // غیرفعال کردن آیکون قبلی
            if (currentIndex > 0) {
                icons[currentIndex - 1].classList.remove('active');
            }
            
            // فعال کردن آیکون فعلی
            icons[currentIndex].classList.add('active');
            
            // افزودن افکت صدا (ویبره)
            if (navigator.vibrate) {
                navigator.vibrate(30);
            }
            
            // رفتن به آیکون بعدی
            currentIndex++;
            
            // اگر همه آیکون‌ها فعال شدند
            if (currentIndex >= iconCount) {
                clearInterval(iconInterval);
                
                // تاخیر و اتمام لودینگ
                setTimeout(() => {
                    finishLoading();
                }, 1000);
            }
        }, intervalTime);
    }
    
    // آپدیت تایمر
    function updateTimer() {
        const timerElement = document.getElementById('electricTimer');
        const startTime = Date.now();
        const totalTime = 7000;
        
        const timerInterval = setInterval(() => {
            const elapsed = Date.now() - startTime;
            const remaining = Math.max(0, totalTime - elapsed);
            const seconds = Math.ceil(remaining / 1000);
            
            if (seconds <= 0) {
                clearInterval(timerInterval);
                timerElement.innerHTML = `<span>سیستم آماده شد!</span>`;
            } else {
                timerElement.innerHTML = `
                    <span>راه‌اندازی در ${seconds} ثانیه</span>
                    <span class="sps-timer-dots">...</span>
                `;
            }
        }, 200);
    }
    
    // پایان لودینگ
    function finishLoading() {
        const loader = document.querySelector('.sps-electric-loader');
        const timerElement = document.getElementById('electricTimer');
        
        // آپدیت نهایی تایمر
        timerElement.innerHTML = `<span style="color: #FFD700;">✅ سیستم فعال شد!</span>`;
        
        // افزودن افکت نهایی
        const centerElement = document.querySelector('.sps-energy-center');
        centerElement.style.animation = 'none';
        centerElement.style.transform = 'translate(50%, -50%) scale(1.3)';
        centerElement.style.filter = 'drop-shadow(0 0 40px #FFD700) drop-shadow(0 0 80px rgba(255, 215, 0, 0.7))';
        
        // تاخیر و انیمیشن خروج
        setTimeout(() => {
            loader.classList.add('fade-out');
            
            setTimeout(() => {
                loader.remove();
                const style = document.getElementById('sps-electric-loader-styles');
                if (style) style.remove();
                
                // ارسال رویداد اتمام لودینگ
                window.dispatchEvent(new CustomEvent('spsElectricLoadingComplete', {
                    detail: { 
                        timestamp: Date.now(),
                        duration: 7000
                    }
                }));
            }, 700);
        }, 800);
    }
    
    // شروع لودینگ
    function initElectricLoader() {
        console.log('⚡ لودینگ برقی SPS در حال راه‌اندازی...');
        
        // شروع انیمیشن آیکون‌ها
        setTimeout(() => {
            animateElectricIcons();
        }, 500);
        
        // شروع تایمر
        updateTimer();
        
        // تایمر کلی 7 ثانیه (فال‌بک)
        setTimeout(() => {
            finishLoading();
        }, 7000);
    }
    
    // شروع پس از بارگذاری صفحه
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initElectricLoader);
    } else {
        initElectricLoader();
    }
    
    // API کنترل برای استفاده خارجی
    window.spsElectricLoader = {
        complete: function() {
            finishLoading();
        },
        onComplete: function(callback) {
            window.addEventListener('spsElectricLoadingComplete', callback);
        },
        getRemainingTime: function() {
            return 7000;
        }
    };
    
})();

// ==================== REVIEWS SYSTEM ====================

let currentRating = 0;
let allReviews = [];
let isReviewsTabActive = false;

// ==================== استایل‌های سیستم نظرات ====================
const reviewsStyles = `
<style id="reviews-styles">
/* استایل‌های سیستم نظرات */
#reviewsTab { display: none; }
#reviewsTab.active { display: block; }

.reviews-section {
    padding: 20px;
    max-width: 800px;
    margin: 0 auto;
    width: 100%;
    box-sizing: border-box;
}

.reviews-header {
    text-align: center;
    margin-bottom: 40px;
    position: relative;
}

.reviews-header h2 {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 10px;
    background: linear-gradient(135deg, #FFD700 0%, #FFAA00 100%);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    font-family: 'Playfair Display', serif;
}

.reviews-header p {
    color: rgba(255, 255, 255, 0.7);
    font-size: 16px;
    margin-bottom: 30px;
    font-family: 'Inter', sans-serif;
}

.overall-rating {
    background: rgba(255, 215, 0, 0.05);
    border: 1px solid rgba(255, 215, 0, 0.15);
    border-radius: 25px;
    padding: 25px;
    margin: 30px auto;
    max-width: 400px;
    backdrop-filter: blur(10px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    position: relative;
    overflow: hidden;
}

.overall-rating::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at top right, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
    pointer-events: none;
}

.rating-number {
    font-size: 48px;
    font-weight: 900;
    color: #FFD700;
    font-family: 'Playfair Display', serif;
    line-height: 1;
    margin-bottom: 15px;
}

.stars-large {
    font-size: 28px;
    color: #FFD700;
    margin-bottom: 15px;
    letter-spacing: 5px;
}

.stars-large i {
    text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
}

.rating-count {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.6);
    font-family: 'Inter', sans-serif;
}

.add-review-container {
    margin: 30px 0;
    animation: slideDown 0.4s ease;
}

@keyframes slideDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

.add-review-card {
    background: #1A1F3C;
    border-radius: 25px;
    padding: 30px;
    border: 1px solid rgba(255, 215, 0, 0.2);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    position: relative;
    overflow: hidden;
}

.add-review-card h3 {
    font-size: 24px;
    margin-bottom: 25px;
    color: #FFD700;
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: 'Inter', sans-serif;
}

.rating-selector {
    margin-bottom: 25px;
}

.rating-label {
    font-size: 16px;
    margin-bottom: 15px;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 500;
    font-family: 'Inter', sans-serif;
}

.stars-selector {
    font-size: 32px;
    color: rgba(255, 255, 255, 0.2);
    cursor: pointer;
    display: flex;
    gap: 5px;
    margin-bottom: 10px;
}

.stars-selector i {
    transition: all 0.3s ease;
}

.stars-selector i:hover {
    transform: scale(1.2);
}

.stars-selector i.active {
    color: #FFD700;
    text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
}

.rating-text {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.6);
    min-height: 20px;
    font-family: 'Inter', sans-serif;
}

.comment-box {
    margin-bottom: 25px;
}

.comment-box textarea {
    width: 100%;
    min-height: 120px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    color: white;
    font-size: 15px;
    font-family: 'Inter', sans-serif;
    resize: vertical;
    transition: all 0.3s ease;
}

.comment-box textarea:focus {
    outline: none;
    border-color: rgba(255, 215, 0, 0.5);
    background: rgba(255, 255, 255, 0.08);
    box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
}

.char-counter {
    text-align: left;
    font-size: 12px;
    color: rgba(255, 255, 255, 0.5);
    margin-top: 5px;
    font-family: 'Inter', sans-serif;
}

.char-counter span {
    color: #FFD700;
}

.review-actions {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
}

.review-actions .btn {
    padding: 12px 25px;
    font-size: 14px;
    font-family: 'Inter', sans-serif;
}

.add-review-btn-container {
    text-align: center;
    margin: 30px 0;
}

.btn-floating {
    padding: 15px 30px;
    background: linear-gradient(135deg, #FFD700 0%, #FFAA00 100%);
    border: none;
    border-radius: 50px;
    color: #1A1F3C;
    font-weight: 700;
    font-size: 15px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
    box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
    font-family: 'Inter', sans-serif;
}

.btn-floating:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 25px rgba(255, 215, 0, 0.4);
}

.reviews-list {
    margin-top: 40px;
}

.review-card {
    background: #1A1F3C;
    border-radius: 25px;
    padding: 25px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.review-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 5px;
    height: 100%;
    background: linear-gradient(135deg, #FFD700 0%, #FFAA00 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.review-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.review-card:hover::before {
    opacity: 1;
}

.review-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.review-user {
    display: flex;
    align-items: center;
    gap: 15px;
}

.user-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #1A1F3C;
    font-weight: 700;
    font-size: 18px;
    box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
}

.user-info h4 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 5px;
    color: white;
    font-family: 'Inter', sans-serif;
}

.user-date {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.5);
    font-family: 'Inter', sans-serif;
}

.review-stars {
    color: #FFD700;
    font-size: 18px;
}

.review-comment {
    color: rgba(255, 255, 255, 0.9);
    line-height: 1.8;
    font-size: 15px;
    margin-top: 15px;
    font-family: 'Inter', sans-serif;
}

.loading-reviews {
    text-align: center;
    padding: 40px;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    border-top-color: #FFD700;
    animation: spin 1s ease-in-out infinite;
    margin: 0 auto 20px;
}

.empty-reviews {
    text-align: center;
    padding: 60px 20px;
}

.empty-reviews i {
    font-size: 60px;
    color: rgba(255, 255, 255, 0.1);
    margin-bottom: 20px;
}

.empty-reviews h3 {
    color: rgba(255, 255, 255, 0.5);
    margin-bottom: 10px;
    font-family: 'Inter', sans-serif;
}

@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.btn-disabled {
    opacity: 0.6;
    cursor: not-allowed !important;
    transform: none !important;
    box-shadow: none !important;
}

@media (max-width: 768px) {
    .reviews-header h2 { font-size: 26px; }
    .rating-number { font-size: 36px; }
    .stars-large { font-size: 22px; }
    .review-card { padding: 20px; }
    .review-header { flex-direction: column; gap: 15px; }
    .review-stars { align-self: flex-start; }
}

@media (max-width: 480px) {
    .overall-rating { padding: 20px; }
    .stars-selector { font-size: 28px; }
    .btn-floating { padding: 12px 25px; font-size: 14px; }
    .review-actions { flex-direction: column; }
}
</style>
`;

// ==================== HTML تب نظرات ====================
const reviewsTabHTML = `
<div id="reviewsTab" class="tab-content">
    <section class="reviews-section">
        <div class="reviews-header">
            <h2><i class="fas fa-star"></i> نظرات و امتیازات</h2>
            <p>تجربه مشتریان ما از خدمات SPS</p>
            
            <div class="overall-rating" id="overallRating">
                <div class="rating-number">۰.۰</div>
                <div class="stars-large">
                    <i class="far fa-star"></i>
                    <i class="far fa-star"></i>
                    <i class="far fa-star"></i>
                    <i class="far fa-star"></i>
                    <i class="far fa-star"></i>
                </div>
                <div class="rating-count">بر اساس <span id="totalReviews">۰</span> نظر</div>
            </div>
        </div>
        
        <div class="add-review-container" id="addReviewContainer" style="display: none;">
            <div class="add-review-card">
                <h3><i class="fas fa-edit"></i> نظر شما</h3>
                
                <div class="rating-selector">
                    <div class="rating-label">امتیاز دهید:</div>
                    <div class="stars-selector">
                        <i class="far fa-star" data-rating="1"></i>
                        <i class="far fa-star" data-rating="2"></i>
                        <i class="far fa-star" data-rating="3"></i>
                        <i class="far fa-star" data-rating="4"></i>
                        <i class="far fa-star" data-rating="5"></i>
                    </div>
                    <div class="rating-text" id="ratingText">لطفا امتیاز انتخاب کنید</div>
                </div>
                
                <div class="comment-box">
                    <textarea 
                        id="reviewComment" 
                        placeholder="تجربه خود از خدمات SPS را بنویسید (حداقل ۱۰ کاراکتر)"
                        maxlength="500"
                    ></textarea>
                    <div class="char-counter">
                        <span id="charCount">0</span>/500
                    </div>
                </div>
                
                <div class="review-actions">
                    <button class="btn btn-secondary" id="cancelReview">
                        انصراف
                    </button>
                    <button class="btn btn-primary" id="submitReview" disabled>
                        <i class="fas fa-paper-plane"></i>
                        ارسال نظر
                    </button>
                </div>
            </div>
        </div>
        
        <div class="add-review-btn-container" id="addReviewBtnContainer" style="display: none;">
            <button class="btn-floating" id="addReviewBtn">
                <i class="fas fa-plus"></i>
                افزودن نظر جدید
            </button>
        </div>
        
        <div class="reviews-list" id="reviewsList">
            <div class="loading-reviews">
                <div class="loading-spinner"></div>
                <p>در حال دریافت نظرات...</p>
            </div>
        </div>
    </section>
</div>
`;

// ==================== SPS ABOUT US - SIMPLE CENTER MENU ====================
(function() {
    'use strict';
    
    console.log('SPS About System - Simple Center Menu');
    
    // ==================== SIMPLE MENU CSS ====================
    const aboutStyles = `
    <style id="sps-about-styles">
        /* Center Nav Button - Simple Hover */
        .center-nav-button {
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .center-nav-button:hover {
            transform: translateY(-5px);
        }
        
        /* Simple Menu */
        .center-nav-menu {
            position: fixed;
            bottom: 100px;
            right: 50%;
            transform: translateX(50%);
            background: rgba(26, 31, 60, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 15px 0;
            width: 160px;
            z-index: 1001;
            display: none;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeInUp 0.2s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateX(50%) translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateX(50%) translateY(0);
            }
        }
        
        /* Menu Arrow */
        .center-nav-menu::before {
            content: '';
            position: absolute;
            bottom: -8px;
            right: 50%;
            transform: translateX(50%);
            width: 16px;
            height: 16px;
            background: #1A1F3C;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            border-right: 1px solid rgba(255, 215, 0, 0.2);
            transform: translateX(50%) rotate(45deg);
        }
        
        /* Menu Item */
        .center-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            cursor: pointer;
            background: none;
            border: none;
            width: 100%;
            text-align: right;
            transition: all 0.3s ease;
        }
        
        .center-menu-item:hover {
            background: rgba(255, 215, 0, 0.1);
            color: #FFD700;
        }
        
        .center-menu-item i {
            color: #FFD700;
            font-size: 16px;
            width: 20px;
        }
        
        /* About Page Styles */
        #spsAboutTab { 
            display: none;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        #spsAboutTab.active { 
            display: block; 
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .sps-about-header {
            text-align: center;
            padding: 40px 20px;
        }
        
        .sps-about-header h1 {
            font-size: 36px;
            color: #FFD700;
            margin-bottom: 15px;
        }
        
        .sps-about-header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .sps-section-title {
            text-align: center;
            margin: 50px 0 30px;
        }
        
        .sps-section-title h2 {
            font-size: 28px;
            color: white;
            margin-bottom: 10px;
        }
        
        .sps-section-title p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 16px;
        }
        
        .sps-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        
        .sps-stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 215, 0, 0.1);
        }
        
        .sps-stat-card i {
            font-size: 32px;
            color: #FFD700;
            margin-bottom: 15px;
        }
        
        .sps-stat-card h3 {
            font-size: 32px;
            color: #FFD700;
            margin: 10px 0;
        }
        
        .sps-stat-card p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }
        
        .sps-services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .sps-service-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sps-service-icon {
            width: 50px;
            height: 50px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #FFD700;
            margin-bottom: 20px;
        }
        
        .sps-service-card h3 {
            font-size: 18px;
            color: white;
            margin-bottom: 10px;
        }
        
        .sps-service-card p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            line-height: 1.6;
        }
        
        .sps-team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .sps-team-member {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sps-member-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto 20px;
            border: 3px solid rgba(255, 215, 0, 0.3);
        }
        
        .sps-member-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .sps-member-name {
            font-size: 18px;
            color: white;
            margin-bottom: 5px;
        }
        
        .sps-member-role {
            color: #FFD700;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .sps-member-bio {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            line-height: 1.6;
        }
        
        /* Loading */
        .sps-loading {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .sps-loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 215, 0, 0.1);
            border-top-color: #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .center-nav-menu {
                bottom: 90px;
                width: 140px;
            }
            
            .sps-about-header h1 {
                font-size: 28px;
            }
            
            .sps-stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .center-nav-menu {
                width: 130px;
            }
            
            .center-menu-item {
                padding: 12px 15px;
                font-size: 13px;
            }
            
            .sps-services-grid,
            .sps-team-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    `;
    
    // ==================== HTML STRUCTURE ====================
    const aboutTabHTML = `
    <div id="spsAboutTab" class="tab-content">
        <div class="sps-about-header">
            <h1>درباره SPS</h1>
            <p>خدمات برقی هوشمند با استانداردهای جهانی</p>
        </div>
        
        <div class="sps-stats-grid" id="spsAboutStats">
            <div class="sps-loading">
                <div class="sps-loading-spinner"></div>
                <p>در حال بارگیری آمار...</p>
            </div>
        </div>
        
        <div class="sps-section-title">
            <h2>خدمات تخصصی</h2>
            <p>با کیفیت و تضمین رضایت مشتری</p>
        </div>
        
        <div class="sps-services-grid" id="spsServicesList">
            <div class="sps-loading">
                <div class="sps-loading-spinner"></div>
                <p>در حال بارگیری خدمات...</p>
            </div>
        </div>
        
        <div class="sps-section-title">
            <h2>تیم متخصص</h2>
            <p>کادری مجرب و با تجربه</p>
        </div>
        
        <div class="sps-team-grid" id="spsTeamMembers">
            <div class="sps-loading">
                <div class="sps-loading-spinner"></div>
                <p>در حال بارگیری اطلاعات تیم...</p>
            </div>
        </div>
    </div>
    `;
    
    // ==================== CORE FUNCTIONS ====================
    
    let isAboutTabActive = false;
    
    // Initialize System
    function initAboutSystem() {
        console.log('Initializing SPS About System...');
        
        // Add Styles
        if (!document.getElementById('sps-about-styles')) {
            document.head.insertAdjacentHTML('beforeend', aboutStyles);
        }
        
        // Add About Page
        if (!document.getElementById('spsAboutTab')) {
            const mainContainer = document.querySelector('.main-container');
            if (mainContainer) {
                mainContainer.insertAdjacentHTML('beforeend', aboutTabHTML);
            } else {
                setTimeout(initAboutSystem, 100);
                return;
            }
        }
        
        // Setup Center Nav
        setupCenterNav();
        
        // Setup Tab Navigation
        setupTabNavigation();
        
        console.log('SPS About System Ready');
    }
    
    // Setup Center Navigation
    function setupCenterNav() {
        const centerButton = document.getElementById('centerNavButton');
        if (!centerButton) {
            console.log('Center nav button not found, retrying...');
            setTimeout(setupCenterNav, 100);
            return;
        }
        
        console.log('Setting up center nav button with menu...');
        
        // Create menu if doesn't exist
        if (!document.getElementById('centerNavMenu')) {
            const menuHTML = `
                <div class="center-nav-menu" id="centerNavMenu">
                    <button class="center-menu-item" data-tab="spsAbout">
                        <i class="fas fa-info-circle"></i>
                        درباره ما
                    </button>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', menuHTML);
        }
        
        // Toggle menu on center button click
        centerButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const menu = document.getElementById('centerNavMenu');
            if (menu) {
                const isVisible = menu.style.display === 'block';
                menu.style.display = isVisible ? 'none' : 'block';
                
                // Add active class for animation
                if (!isVisible) {
                    this.classList.add('active');
                } else {
                    this.classList.remove('active');
                }
            }
        });
        
        // Handle menu item click
        document.getElementById('centerNavMenu')?.addEventListener('click', function(e) {
            const item = e.target.closest('.center-menu-item');
            if (!item) return;
            
            // Close menu
            this.style.display = 'none';
            centerButton.classList.remove('active');
            
            // Go to about page
            const tab = item.getAttribute('data-tab');
            if (tab === 'spsAbout') {
                switchTab('spsAbout');
            }
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('centerNavMenu');
            const centerButton = document.getElementById('centerNavButton');
            
            if (menu && 
                !menu.contains(e.target) && 
                !centerButton?.contains(e.target)) {
                menu.style.display = 'none';
                centerButton?.classList.remove('active');
            }
        });
    }
    
    // Switch between tabs
    function switchTab(tabName) {
        console.log('Switching to tab:', tabName);
        
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.querySelectorAll('.nav-item').forEach(nav => {
            nav.classList.remove('active');
        });
        
        // Show selected tab
        if (tabName === 'spsAbout') {
            const aboutTab = document.getElementById('spsAboutTab');
            if (aboutTab) {
                aboutTab.classList.add('active');
                isAboutTabActive = true;
                loadAboutData();
            }
        } else {
            const tab = document.getElementById(tabName + 'Tab');
            if (tab) {
                tab.classList.add('active');
            }
            
            const nav = document.querySelector(`[data-tab="${tabName}"]`);
            if (nav) {
                nav.classList.add('active');
            }
            
            isAboutTabActive = false;
        }
        
        // Scroll to top
        const mainContainer = document.querySelector('.main-container');
        if (mainContainer) {
            mainContainer.scrollTop = 0;
        }
    }
    
    // Setup tab navigation
    function setupTabNavigation() {
        document.addEventListener('click', function(e) {
            const navItem = e.target.closest('.nav-item');
            if (navItem) {
                const tab = navItem.getAttribute('data-tab');
                if (tab === 'spsAbout') {
                    e.preventDefault();
                    switchTab('spsAbout');
                }
            }
        });
    }
    
    // Load all about data
    async function loadAboutData() {
        if (!isAboutTabActive) return;
        
        console.log('Loading about page data...');
        
        try {
            await Promise.all([
                loadStats(),
                loadServices(),
                loadTeam()
            ]);
        } catch (error) {
            console.error('Error loading about data:', error);
        }
    }
    
    // Load statistics from Supabase
    async function loadStats() {
        try {
            const statsGrid = document.getElementById('spsAboutStats');
            if (!statsGrid) return;
            
            const { data, error } = await supabase
                .from('about_stats')
                .select('*')
                .order('id');
            
            if (error) throw error;
            
            if (!data || data.length === 0) {
                statsGrid.innerHTML = '<p class="sps-loading">داده‌ای یافت نشد</p>';
                return;
            }
            
            let html = '';
            data.forEach(stat => {
                if (stat.value && stat.label) {
                    html += `
                        <div class="sps-stat-card">
                            <i class="fas ${stat.icon || 'fa-chart-line'}"></i>
                            <h3>${stat.value}</h3>
                            <p>${stat.label}</p>
                        </div>
                    `;
                }
            });
            
            statsGrid.innerHTML = html;
            
        } catch (error) {
            console.error('Error loading stats:', error);
            document.getElementById('spsAboutStats').innerHTML = 
                '<p class="sps-loading">خطا در بارگیری آمار</p>';
        }
    }
    
    // Load services from Supabase
    async function loadServices() {
        try {
            const servicesList = document.getElementById('spsServicesList');
            if (!servicesList) return;
            
            const { data, error } = await supabase
                .from('services')
                .select('*')
                .order('order');
            
            if (error) throw error;
            
            if (!data || data.length === 0) {
                servicesList.innerHTML = '<p class="sps-loading">داده‌ای یافت نشد</p>';
                return;
            }
            
            let html = '';
            data.forEach(service => {
                if (service.title && service.description) {
                    html += `
                        <div class="sps-service-card">
                            <div class="sps-service-icon">
                                <i class="fas ${service.icon || 'fa-cog'}"></i>
                            </div>
                            <h3>${service.title}</h3>
                            <p>${service.description}</p>
                        </div>
                    `;
                }
            });
            
            servicesList.innerHTML = html;
            
        } catch (error) {
            console.error('Error loading services:', error);
            document.getElementById('spsServicesList').innerHTML = 
                '<p class="sps-loading">خطا در بارگیری خدمات</p>';
        }
    }
    
    // Load team members from Supabase
    async function loadTeam() {
        try {
            const teamMembers = document.getElementById('spsTeamMembers');
            if (!teamMembers) return;
            
            const { data, error } = await supabase
                .from('team_members')
                .select('*')
                .order('order');
            
            if (error) throw error;
            
            if (!data || data.length === 0) {
                teamMembers.innerHTML = '<p class="sps-loading">داده‌ای یافت نشد</p>';
                return;
            }
            
            let html = '';
            data.forEach(member => {
                if (member.name && member.role) {
                    const avatarUrl = member.image || 
                        `https://ui-avatars.com/api/?name=${encodeURIComponent(member.name)}&background=FFD700&color=1A1F3C`;
                    
                    html += `
                        <div class="sps-team-member">
                            <div class="sps-member-avatar">
                                <img src="${avatarUrl}" 
                                     alt="${member.name}"
                                     onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(member.name)}&background=FFD700&color=1A1F3C'">
                            </div>
                            <h4 class="sps-member-name">${member.name}</h4>
                            <p class="sps-member-role">${member.role}</p>
                            ${member.bio ? `<p class="sps-member-bio">${member.bio}</p>` : ''}
                        </div>
                    `;
                }
            });
            
            teamMembers.innerHTML = html;
            
        } catch (error) {
            console.error('Error loading team:', error);
            document.getElementById('spsTeamMembers').innerHTML = 
                '<p class="sps-loading">خطا در بارگیری اطلاعات تیم</p>';
        }
    }
    
    // ==================== INITIALIZATION ====================
    
    // Wait for DOM and Supabase
    function start() {
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM Content Loaded');
                checkSupabase();
            });
        } else {
            checkSupabase();
        }
    }
    
    // Check if Supabase is loaded
    function checkSupabase() {
        if (window.supabase) {
            console.log('Supabase found, initializing...');
            setTimeout(initAboutSystem, 500);
        } else {
            console.log('Waiting for Supabase...');
            setTimeout(checkSupabase, 100);
        }
    }
    
    // Start the system
    start();
    
    // Export functions for debugging
    window.spsAbout = {
        init: initAboutSystem,
        toggleMenu: function() {
            const menu = document.getElementById('centerNavMenu');
            if (menu) {
                menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
            }
        },
        showAbout: function() {
            switchTab('spsAbout');
        }
    };
    
    console.log('SPS About System Script Loaded');
    
})();

// ==================== توابع اصلی سیستم ====================

// راه‌اندازی سیستم نظرات
async function initializeReviewsSystem() {
    console.log('🔄 Initializing Reviews System...');
    
    // تنظیم رویدادها
    setupReviewsEvents();
    
    // بررسی وضعیت کاربر
    const { data: sessionData } = await supabase.auth.getSession();
    updateReviewFormVisibility(sessionData?.session);
    
    // گوش دادن به تغییرات auth state
    supabase.auth.onAuthStateChange((event, session) => {
        updateReviewFormVisibility(session);
    });
}

// بارگیری نظرات از Supabase
async function loadReviews() {
    try {
        // فقط اگر تب نظرات فعال است بارگیری کن
        if (!isReviewsTabActive) return;
        
        const reviewsList = document.getElementById('reviewsList');
        if (!reviewsList) return;
        
        reviewsList.innerHTML = `
            <div class="loading-reviews">
                <div class="loading-spinner"></div>
                <p>در حال دریافت نظرات...</p>
            </div>
        `;
        
        // دریافت نظرات
        const { data: reviews, error } = await supabase
            .from('reviews')
            .select('*')
            .order('created_at', { ascending: false });
        
        if (error) throw error;
        
        allReviews = reviews || [];
        
        // نمایش نظرات
        displayReviews(allReviews);
        
        // آپدیت آمار کلی
        updateOverallRating(allReviews);
        
    } catch (error) {
        console.error('❌ Error loading reviews:', error);
        const reviewsList = document.getElementById('reviewsList');
        if (reviewsList) {
            reviewsList.innerHTML = `
                <div class="empty-reviews">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>خطا در دریافت نظرات</h3>
                    <p>لطفاً دوباره تلاش کنید</p>
                    <button class="btn btn-secondary" onclick="loadReviews()">
                        تلاش مجدد
                    </button>
                </div>
            `;
        }
    }
}

// نمایش نظرات
function displayReviews(reviews) {
    const reviewsList = document.getElementById('reviewsList');
    if (!reviewsList) return;
    
    if (!reviews || reviews.length === 0) {
        reviewsList.innerHTML = `
            <div class="empty-reviews">
                <i class="far fa-comment-alt"></i>
                <h3>هنوز نظری ثبت نشده</h3>
                <p>اولین نفری باشید که نظر می‌دهد</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    reviews.forEach((review, index) => {
        // تاریخ فارسی
        const date = new Date(review.created_at);
        const persianDate = date.toLocaleDateString('fa-IR');
        const time = date.toLocaleTimeString('fa-IR', { 
            hour: '2-digit', 
            minute: '2-digit' 
        });
        
        // ستاره‌ها
        let starsHtml = '';
        for (let i = 1; i <= 5; i++) {
            starsHtml += i <= review.rating 
                ? '<i class="fas fa-star"></i>' 
                : '<i class="far fa-star"></i>';
        }
        
        // نام اول کاربر
        const firstName = review.user_name?.split(' ')[0] || 'کاربر';
        const avatarText = firstName.charAt(0);
        
        // رنگ‌های مختلف برای آواتار
        const avatarColors = [
            'linear-gradient(135deg, #FFD700 0%, #FFAA00 100%)',
            'linear-gradient(135deg, #00FFFF 0%, #9966FF 100%)',
            'linear-gradient(135deg, #FF66B2 0%, #9966FF 100%)',
            'linear-gradient(135deg, #00FFAA 0%, #00AAFF 100%)'
        ];
        const avatarColor = avatarColors[review.user_name?.length % avatarColors.length];
        
        html += `
            <div class="review-card" style="animation: fadeInUp 0.5s ease ${index * 0.1}s both">
                <div class="review-header">
                    <div class="review-user">
                        <div class="user-avatar" style="background: ${avatarColor}">
                            ${avatarText}
                        </div>
                        <div class="user-info">
                            <h4>${review.user_name}</h4>
                            <div class="user-date">
                                <i class="far fa-clock"></i>
                                ${persianDate} - ${time}
                            </div>
                        </div>
                    </div>
                    <div class="review-stars">
                        ${starsHtml}
                    </div>
                </div>
                <div class="review-comment">
                    ${review.comment}
                </div>
            </div>
        `;
    });
    
    reviewsList.innerHTML = html;
}

// آپدیت آمار کلی
function updateOverallRating(reviews) {
    const overallRatingEl = document.getElementById('overallRating');
    if (!overallRatingEl) return;
    
    if (!reviews || reviews.length === 0) {
        overallRatingEl.innerHTML = `
            <div class="rating-number">۰.۰</div>
            <div class="stars-large">
                <i class="far fa-star"></i>
                <i class="far fa-star"></i>
                <i class="far fa-star"></i>
                <i class="far fa-star"></i>
                <i class="far fa-star"></i>
            </div>
            <div class="rating-count">هنوز نظری ثبت نشده</div>
        `;
        const totalReviewsEl = document.getElementById('totalReviews');
        if (totalReviewsEl) totalReviewsEl.textContent = '۰';
        return;
    }
    
    // محاسبه میانگین
    const totalRating = reviews.reduce((sum, review) => sum + review.rating, 0);
    const averageRating = (totalRating / reviews.length).toFixed(1);
    
    // آپدیت عدد
    const ratingNumber = document.querySelector('.rating-number');
    if (ratingNumber) ratingNumber.textContent = averageRating;
    
    const totalReviewsEl = document.getElementById('totalReviews');
    if (totalReviewsEl) totalReviewsEl.textContent = reviews.length;
    
    // آپدیت ستاره‌ها
    const stars = document.querySelectorAll('.stars-large i');
    const fullStars = Math.floor(averageRating);
    const hasHalfStar = averageRating % 1 >= 0.5;
    
    stars.forEach((star, index) => {
        if (index < fullStars) {
            star.className = 'fas fa-star';
        } else if (index === fullStars && hasHalfStar) {
            star.className = 'fas fa-star-half-alt';
        } else {
            star.className = 'far fa-star';
        }
    });
}

// آپدیت دیدنی بودن فرم بر اساس وضعیت کاربر
function updateReviewFormVisibility(session) {
    const addReviewContainer = document.getElementById('addReviewContainer');
    const addReviewBtnContainer = document.getElementById('addReviewBtnContainer');
    
    if (!addReviewContainer || !addReviewBtnContainer) return;
    
    if (session?.user) {
        // کاربر لاگین کرده - نمایش دکمه
        addReviewBtnContainer.style.display = 'block';
    } else {
        // کاربر لاگین نکرده - مخفی کردن
        addReviewContainer.style.display = 'none';
        addReviewBtnContainer.style.display = 'none';
    }
}

// تنظیم رویدادهای سیستم نظرات
function setupReviewsEvents() {
    // دکمه افزودن نظر
    const addReviewBtn = document.getElementById('addReviewBtn');
    if (addReviewBtn) {
        addReviewBtn.addEventListener('click', function() {
            const container = document.getElementById('addReviewContainer');
            if (!container) return;
            
            // نمایش فرم
            container.style.display = 'block';
            resetReviewForm(); // همیشه فرم خالی
            
            container.scrollIntoView({ behavior: 'smooth' });
        });
    }
    
    // انتخاب ستاره
    document.querySelectorAll('.stars-selector i').forEach(star => {
        star.addEventListener('click', function() {
            currentRating = parseInt(this.getAttribute('data-rating'));
            updateStarsDisplay();
            updateSubmitButton();
        });
        
        star.addEventListener('mouseenter', function() {
            const hoverRating = parseInt(this.getAttribute('data-rating'));
            highlightStars(hoverRating);
        });
        
        star.addEventListener('mouseleave', function() {
            updateStarsDisplay();
        });
    });
    
    // شمارشگر کاراکتر
    const reviewComment = document.getElementById('reviewComment');
    if (reviewComment) {
        reviewComment.addEventListener('input', function() {
            updateCharCounter();
            updateSubmitButton();
        });
    }
    
    // دکمه انصراف
    const cancelReview = document.getElementById('cancelReview');
    if (cancelReview) {
        cancelReview.addEventListener('click', function() {
            const container = document.getElementById('addReviewContainer');
            if (container) container.style.display = 'none';
            resetReviewForm();
        });
    }
    
    // ارسال نظر
    const submitReviewBtn = document.getElementById('submitReview');
    if (submitReviewBtn) {
        submitReviewBtn.addEventListener('click', submitReview);
    }
}

// برجسته کردن ستاره‌ها (برای hover)
function highlightStars(rating) {
    document.querySelectorAll('.stars-selector i').forEach((star, index) => {
        if (index < rating) {
            star.classList.add('active');
            star.classList.remove('far');
            star.classList.add('fas');
        } else {
            star.classList.remove('active');
            star.classList.add('far');
            star.classList.remove('fas');
        }
    });
    
    // آپدیت متن
    const texts = ['خیلی بد', 'بد', 'متوسط', 'خوب', 'عالی'];
    const ratingText = document.getElementById('ratingText');
    if (ratingText) {
        ratingText.textContent = texts[rating - 1] || 'لطفا امتیاز انتخاب کنید';
    }
}

// آپدیت نمایش ستاره‌ها
function updateStarsDisplay() {
    document.querySelectorAll('.stars-selector i').forEach((star, index) => {
        if (index < currentRating) {
            star.classList.add('active');
            star.classList.remove('far');
            star.classList.add('fas');
        } else {
            star.classList.remove('active');
            star.classList.add('far');
            star.classList.remove('fas');
        }
    });
    
    // آپدیت متن
    const texts = ['خیلی بد', 'بد', 'متوسط', 'خوب', 'عالی'];
    const ratingText = document.getElementById('ratingText');
    if (ratingText) {
        ratingText.textContent = texts[currentRating - 1] || 'لطفا امتیاز انتخاب کنید';
    }
}

// آپدیت شمارشگر کاراکتر
function updateCharCounter() {
    const textarea = document.getElementById('reviewComment');
    const charCountElement = document.getElementById('charCount');
    if (!textarea || !charCountElement) return;
    
    const charCount = textarea.value.length;
    charCountElement.textContent = charCount;
    
    const counter = document.querySelector('.char-counter');
    if (counter) {
        counter.style.color = charCount < 10 ? '#ff6b6b' : 
                            charCount > 450 ? '#FFD700' : 
                            'rgba(255, 255, 255, 0.5)';
    }
}

// آپدیت وضعیت دکمه ارسال
function updateSubmitButton() {
    const submitBtn = document.getElementById('submitReview');
    const commentElement = document.getElementById('reviewComment');
    if (!submitBtn || !commentElement) return;
    
    const comment = commentElement.value.trim();
    const isValid = currentRating > 0 && comment.length >= 10;
    
    submitBtn.disabled = !isValid;
    submitBtn.classList.toggle('btn-disabled', !isValid);
}

// ارسال نظر
async function submitReview() {
    try {
        if (currentRating === 0) {
            showNotification('لطفاً امتیاز خود را انتخاب کنید', 'error');
            return;
        }
        
        const commentElement = document.getElementById('reviewComment');
        if (!commentElement) return;
        
        const comment = commentElement.value.trim();
        if (comment.length < 10) {
            showNotification('نظر باید حداقل ۱۰ کاراکتر باشد', 'error');
            return;
        }
        
        const { data: sessionData } = await supabase.auth.getSession();
        if (!sessionData?.session?.user) {
            showNotification('لطفاً ابتدا وارد حساب کاربری خود شوید', 'error');
            return;
        }
        
        const user = sessionData.session.user;
        const userName = user.user_metadata?.full_name || 'کاربر ناشناس';
        
        const submitBtn = document.getElementById('submitReview');
        if (!submitBtn) return;
        
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<div class="loading"></div> در حال ارسال...';
        submitBtn.disabled = true;
        
        // ایجاد نظر جدید
        const result = await supabase
            .from('reviews')
            .insert([{
                user_id: user.id,
                user_name: userName,
                user_email: user.email,
                rating: currentRating,
                comment: comment
            }]);
        
        if (result.error) throw result.error;
        
        showNotification('نظر شما با موفقیت ثبت شد', 'success');
        
        // پاک کردن کامل فرم
        resetReviewForm();
        
        // مخفی کردن فرم
        const addReviewContainer = document.getElementById('addReviewContainer');
        if (addReviewContainer) addReviewContainer.style.display = 'none';
        
        // بارگیری مجدد نظرات
        await loadReviews();
        
        // بازگشت دکمه به حالت عادی
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        
    } catch (error) {
        console.error('❌ Error submitting review:', error);
        showNotification('خطا در ارسال نظر', 'error');
        
        const submitBtn = document.getElementById('submitReview');
        if (submitBtn) {
            submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> ارسال نظر';
            submitBtn.disabled = false;
        }
    }
}

// ریست فرم (کاملاً خالی)
function resetReviewForm() {
    currentRating = 0;
    
    // ریست ستاره‌ها
    const stars = document.querySelectorAll('.stars-selector i');
    if (stars.length > 0) {
        stars.forEach(star => {
            star.classList.remove('active');
            star.classList.remove('fas');
            star.classList.add('far');
        });
    }
    
    // ریست متن
    const ratingText = document.getElementById('ratingText');
    if (ratingText) {
        ratingText.textContent = 'لطفا امتیاز انتخاب کنید';
    }
    
    // ریست کامنت
    const reviewComment = document.getElementById('reviewComment');
    if (reviewComment) {
        reviewComment.value = '';
    }
    
    // ریست شمارنده
    updateCharCounter();
    
    // غیرفعال کردن دکمه
    updateSubmitButton();
}

// ==================== ادغام با سیستم اصلی ====================

// اضافه کردن تب نظرات به نویگیشن
function addReviewsTabToNavigation() {
    const diamondNavItem = document.querySelector('[data-tab="diamond"]');
    if (diamondNavItem) {
        const navItem = diamondNavItem.closest('li');
        if (navItem) {
            navItem.insertAdjacentHTML('afterend', `
                <li>
                    <a href="#" class="nav-item" data-tab="reviews">
                        <i class="fas fa-comments nav-icon"></i>
                        <span class="nav-text">نظرات</span>
                    </a>
                </li>
            `);
        }
    }
}

// اضافه کردن تب محتوا
function addReviewsTabContent() {
    const tabContents = document.querySelector('.main-container');
    if (tabContents && !document.getElementById('reviewsTab')) {
        tabContents.insertAdjacentHTML('beforeend', reviewsTabHTML);
    }
}

// مدیریت کلید تب‌ها
function setupTabManagement() {
    document.addEventListener('click', function(e) {
        const navItem = e.target.closest('.nav-item');
        if (!navItem) return;
        
        const tab = navItem.getAttribute('data-tab');
        if (!tab) return;
        
        // غیرفعال کردن همه
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // فعال کردن انتخاب شده
        navItem.classList.add('active');
        const tabElement = document.getElementById(tab + 'Tab');
        if (tabElement) {
            tabElement.classList.add('active');
        }
        
        // مدیریت وضعیت تب نظرات
        if (tab === 'reviews') {
            isReviewsTabActive = true;
            loadReviews();
        } else {
            isReviewsTabActive = false;
        }
        
        // اسکرول به بالا
        document.querySelector('.main-container').scrollTop = 0;
    });
}

// تابع اصلی برای راه‌اندازی سیستم
function setupReviewsSystem() {
    // اضافه کردن استایل‌ها
    if (!document.getElementById('reviews-styles')) {
        document.head.insertAdjacentHTML('beforeend', reviewsStyles);
    }
    
    // اضافه کردن تب به نویگیشن
    addReviewsTabToNavigation();
    
    // اضافه کردن تب محتوا
    addReviewsTabContent();
    
    // تنظیم مدیریت تب‌ها
    setupTabManagement();
    
    // راه‌اندازی سیستم
    setTimeout(() => {
        initializeReviewsSystem();
    }, 1000);
}

// ==================== اجرای سیستم ====================

// اجرا پس از بارگذاری کامل
document.addEventListener('DOMContentLoaded', function() {
    // تاخیر برای اطمینان از بارگیری بقیه سیستم
    setTimeout(() => {
        setupReviewsSystem();
    }, 500);
});

// اضافه کردن تابع loadReviews به window برای دسترسی از HTML
window.loadReviews = loadReviews;

// ==================== سیستم پروژه‌های کامل ====================

let allProjectsData = [];
let currentFilterType = 'all';

// 1. تابع اصلی لود پروژه‌ها
async function loadAllProjects() {
    try {
        console.log('📡 در حال اتصال به دیتابیس...');
        
        const grid = document.getElementById('projectsGrid');
        if (!grid) {
            console.error('❌ المنت projectsGrid پیدا نشد!');
            return;
        }
        
        // نمایش لودینگ
        grid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 60px;">
                <div style="width: 50px; height: 50px; border: 3px solid rgba(255,215,0,0.3); border-top-color: #FFD700; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                <p style="color: rgba(255,255,255,0.7);">در حال بارگیری پروژه‌ها...</p>
            </div>
        `;
        
        // دریافت داده‌ها
        const { data, error } = await supabase
            .from('projects')
            .select('*')
            .order('created_at', { ascending: false });
            
        if (error) {
            console.error('❌ خطای Supabase:', error);
            throw error;
        }
        
        allProjectsData = data || [];
        console.log(`✅ ${allProjectsData.length} پروژه دریافت شد`);
        
        // نمایش پروژه‌ها
        renderProjects(allProjectsData);
        
    } catch (error) {
        console.error('❌ خطا در بارگیری:', error);
        const grid = document.getElementById('projectsGrid');
        if (grid) {
            grid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: #ff6b6b;">
                    <p style="margin-bottom: 15px;">خطا در بارگیری پروژه‌ها</p>
                    <button onclick="loadAllProjects()" style="padding: 10px 25px; background: #FFD700; color: #1A1F3C; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        تلاش مجدد
                    </button>
                </div>
            `;
        }
    }
}

// 2. نمایش پروژه‌ها
function renderProjects(projects) {
    const grid = document.getElementById('projectsGrid');
    if (!grid) return;
    
    if (!projects || projects.length === 0) {
        grid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: rgba(255,255,255,0.5);">
                <i class="fas fa-folder-open" style="font-size: 50px; margin-bottom: 20px; opacity: 0.3;"></i>
                <p>پروژه‌ای برای نمایش وجود ندارد</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    projects.forEach((project, index) => {
        // تاریخ‌ها
        const startDate = new Date(project.start_date);
        const endDate = new Date(project.end_date);
        const persianStart = startDate.toLocaleDateString('fa-IR');
        const persianEnd = endDate.toLocaleDateString('fa-IR');
        
        // وضعیت
        let statusClass = '';
        let statusText = '';
        let statusIcon = '';
        
        switch(project.status) {
            case 'completed':
                statusClass = 'status-completed';
                statusText = 'تکمیل شده';
                statusIcon = 'fas fa-check-circle';
                break;
            case 'in_progress':
                statusClass = 'status-inprogress';
                statusText = 'در حال اجرا';
                statusIcon = 'fas fa-sync-alt';
                break;
            case 'upcoming':
                statusClass = 'status-upcoming';
                statusText = 'آینده';
                statusIcon = 'fas fa-clock';
                break;
            default:
                statusClass = 'status-completed';
                statusText = 'تکمیل شده';
                statusIcon = 'fas fa-check-circle';
        }
        
        // تصویر
        const imageUrl = project.images && project.images.length > 0 
            ? project.images[0] 
            : 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=400&fit=crop';
        
        // دسته‌بندی آیکون
        let categoryIcon = 'fas fa-folder';
        switch(project.category) {
            case 'مسکونی': categoryIcon = 'fas fa-home'; break;
            case 'تجاری': categoryIcon = 'fas fa-store'; break;
            case 'صنعتی': categoryIcon = 'fas fa-industry'; break;
            default: categoryIcon = 'fas fa-building';
        }
        
        html += `
            <div class="project-card" onclick="showProjectDetails(${index})">
                <div class="project-image">
                    <img src="${imageUrl}" 
                         alt="${project.title}" 
                         loading="lazy"
                         onerror="this.src='https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=400&fit=crop'">
                    <div class="project-badge ${statusClass}">
                        <i class="${statusIcon}"></i>
                        ${statusText}
                    </div>
                </div>
                
                <div class="project-content">
                    <h3 class="project-title">${project.title}</h3>
                    <p class="project-description">
                        ${project.short_description || project.description?.substring(0, 100) + '...' || 'توضیحاتی ثبت نشده است'}
                    </p>
                    
                    <div class="project-dates">
                        <div class="date-box">
                            <div class="date-label">تاریخ شروع</div>
                            <div class="date-value">${persianStart}</div>
                        </div>
                        <div class="date-box">
                            <div class="date-label">تاریخ پایان</div>
                            <div class="date-value">${persianEnd}</div>
                        </div>
                    </div>
                    
                    <div class="project-info">
                        <div class="info-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${project.location || 'ثبت نشده'}</span>
                        </div>
                        <div class="info-item">
                            <i class="${categoryIcon}"></i>
                            <span>${project.category || 'عمومی'}</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    grid.innerHTML = html;
}

// 3. فیلتر پروژه‌ها
function filterProjects(category) {
    // آپدیت دکمه‌های فیلتر
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    currentFilterType = category;
    
    let filtered = [];
    if (category === 'all') {
        filtered = allProjectsData;
    } else {
        filtered = allProjectsData.filter(project => 
            project.category === category
        );
    }
    
    renderProjects(filtered);
}

// 4. نمایش جزئیات پروژه
function showProjectDetails(index) {
    const projectsToShow = currentFilterType === 'all' ? allProjectsData : 
                         allProjectsData.filter(p => p.category === currentFilterType);
    
    const project = projectsToShow[index];
    if (!project) return;
    
    // پر کردن مودال
    document.getElementById('modalProjectTitle').textContent = project.title;
    document.getElementById('modalProjectDescription').textContent = project.description || 'توضیحاتی ثبت نشده است';
    
    const startDate = new Date(project.start_date);
    const endDate = new Date(project.end_date);
    
    document.getElementById('modalStartDate').textContent = startDate.toLocaleDateString('fa-IR');
    document.getElementById('modalEndDate').textContent = endDate.toLocaleDateString('fa-IR');
    document.getElementById('modalCategory').textContent = project.category || 'عمومی';
    document.getElementById('modalLocation').textContent = project.location || 'ثبت نشده';
    document.getElementById('modalClient').textContent = project.client_name || 'ثبت نشده';
    
    // وضعیت فارسی
    let statusText = 'تکمیل شده';
    if (project.status === 'in_progress') statusText = 'در حال اجرا';
    if (project.status === 'upcoming') statusText = 'آینده';
    document.getElementById('modalStatus').textContent = statusText;
    
    // نمایش مودال
    document.getElementById('projectModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

// 5. بستن مودال
function closeProjectModal() {
    document.getElementById('projectModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// 6. راه‌اندازی سیستم
function initializeProjectsSystem() {
    console.log('🚀 راه‌اندازی سیستم پروژه‌ها...');
    
    // الف) اضافه کردن تب به نویگیشن
    setTimeout(() => {
        if (!document.querySelector('[data-tab="projects"]')) {
            const homeTab = document.querySelector('[data-tab="home"]');
            if (homeTab) {
                const homeLi = homeTab.closest('li');
                if (homeLi) {
                    homeLi.insertAdjacentHTML('afterend', `
                        <li>
                            <a href="#" class="nav-item" data-tab="projects">
                                <i class="fas fa-project-diagram nav-icon"></i>
                                <span class="nav-text">پروژه‌ها</span>
                            </a>
                        </li>
                    `);
                    console.log('✅ تب پروژه‌ها اضافه شد');
                }
            }
        }
    }, 100);
    
    // ب) بارگیری پروژه‌ها
    setTimeout(() => {
        loadAllProjects();
    }, 500);
    
    // ج) رویداد کلیک روی تب‌ها
    document.addEventListener('click', function(e) {
        const navItem = e.target.closest('.nav-item');
        if (navItem) {
            const tab = navItem.getAttribute('data-tab');
            
            // غیرفعال کردن همه
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // فعال کردن تب انتخاب شده
            navItem.classList.add('active');
            
            if (tab === 'projects') {
                document.getElementById('projectsTab')?.classList.add('active');
            } else {
                document.getElementById(tab + 'Tab')?.classList.add('active');
            }
            
            // اسکرول به بالا
            document.querySelector('.main-container').scrollTop = 0;
        }
        
        // بستن مودال با کلیک روی overlay
        if (e.target.id === 'projectModal') {
            closeProjectModal();
        }
    });
    
    // د) رویداد کلیک روی دکمه بستن مودال
    document.getElementById('closeModal')?.addEventListener('click', closeProjectModal);
}

// 7. اجرای اولیه
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeProjectsSystem);
} else {
    initializeProjectsSystem();
}

// 8. اضافه کردن توابع به window
window.showProjectDetails = showProjectDetails;
window.closeProjectModal = closeProjectModal;
window.filterProjects = filterProjects;
window.loadAllProjects = loadAllProjects;
</script>
</body>
    </html>
